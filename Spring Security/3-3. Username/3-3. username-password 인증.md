<h1>Username/Password 인증</h1>

- 사용자에 대한 인증을 수행하는 가장 보편적인 방법 중 하나는 username과 password를 검증하는 것이다.  
  Spring Security는 이 방식을 통한 인증을 지원한다.

<h3>Username, Password 읽기</h3>

- Spring Security는 `HttpServletRequest`로부터 username, password를 읽기 위해 아래의 방식들을 제공한다.
  - Form Login
  - Basic Authentication
  - Digest Authentication

<h3>Storage 메커니즘</h3>

- 위에서 Spring Security가 제공하는 방식들은 아래의 저장소 메커니즘을 사용할 수 있다.
  - Simple Storage with `In-Memory Authentication`
  - Relational Databases with `JDBC Authentication`
  - Custom data stores with `UserDetailsService`
  - LDAP storage with `LDAP Authentication`

<hr/>

# Form Login

- Spring Security는 html form을 통한 username, password 인증 방식을 지원한다.

- 우선 아래 그림을 통해 form으로 진행되는 username/password 방식이 Spring Security에서 어떻게 처리되는지 살펴보자.

![picture 1](../../images/0d34de42dc61a8b99889f1e433a3208850362900fd24781676656f4a214c47b0.png)

- 위 그림의 프로세스는 `SecurityFilterChain`이 중심이 되어 작동한다.

  - (1) : 사용자가 `/private` 엔드포인트에 대해 인증이 되어있지 않은 요청을 수행한다.
  - (2) : Spring Security의 `FilterSecurityInterceptor`가 `AccessDeniedException`을 발생시켜 해당 요청이 "denied"됨을 알린다.
  - (3) : 사용자가 인증이 되어있지 않기에, `ExceptionTranslationFilter`는 사용자를 `AuthenticationEntryPoint`에 설정된 페이지로  
    이동시켜 인증을 진행하도록 한다. 보통 이 때 사용되는 `AuthenticationEntryPoint`는 `LoginUrlAuthenticationEntryPoint`의 인스턴스이다.
  - (4) : 브라우저는 화면을 로그인 페이지로 이동시킨다.
  - (5) : login.html을 반환한다. (**프로그램은 무조건 login 페이지를 렌더링 하도록 해야 한다.**)

- 이후에 username과 password가 제공되면, `UsernamePasswordAuthenticationFilter`가 username과 password에 대한  
  인증 작업을 시작한다. `UsernamePasswordAuthenticationFilter`는 `AbstractAuthenticationProcessingFilter`를 상속한다.  
  이후 과정에 대한 설명은 <a href="https://github.com/sangwoo-98/Study/blob/master/Spring%20Security/3-2%20More%20classes%20for%20authentication.md#AbstractAuthenticationProcessingFilter">링크</a>에서 볼 수 있다.

- Spring Security의 form login은 기본적으로 작동되도록 설정되어 있다.  
  하지만 만약 servlet 바탕의 설정 클래스가 추가된다면, form login을 무조건 명시적으로 지정해야 한다.  
  아래는 최소한의 Java Configuration 코드이다.

```java
protected void configure(HttpSecurity http) {
    http
        //..
        .formLogin(withDefaults());
}
```

- 위 설정대로는 Spring Security는 기본적인 login 페이지를 띄울 것이다.  
  대부분의 프로덕트 레벨 애플리케이션은 이 폼을 따로 작성한다.  
  커스텀으로 만들어진 폼을 반환하는 코드는 아래와 같다.

```java
protected void configure(HttpSecurity http) throws Exception {
    http
        //..
        .formLogin(form -> form
                    .loginPage("/login")
                    .permitAll());
}
```

- 위와 같이 login 페이지가 Spring Security Configuration 클래스를 통해 지정되면, 개발자는 해당 페이지를  
  렌더링할 책임이 있다.
