# 시간 제한, 재시도 및 지터를 사용한 백오프

- <a href="https://aws.amazon.com/ko/builders-library/timeouts-retries-and-backoff-with-jitter/?did=ba_card&trk=ba_card">Amazon Builder's Library</a>

## 장애 발생 및 복원력

- 서비스는 서버, 네트워크, 로드 밸런서, 운영자의 실수까지 등 많은 요인들로부터 장애가 발생할 수 있다.  
  장애 가능성이 낮은 시스템을 설계할 수 있으나, 결코 실패하지 않는 시스템을 구축하는 것은 불가하다.

> - 복원력: 시스템의 장애 가능성을 줄이고, 실패를 허용하는 시스템을 설계해 **작은 규모의 장애가 전면적인 가동 중단으로 확대되는 것을 방지하는 능력**

- AWS에서는 _복원력_ 이 우수한 시스템을 구축하기 위해 **시간 제한, 재시도, 백오프** 를 제시한다.

- 이 각각을 AWS에서는 어떻게 처리하는 지에 대해 보기전에, 개념을 간단히 훑어보자.

### 시간 제한

- 수많은 장애 유형은 **요청이 평소보다 오래 걸리고 완료되지 않을 때** 명확히 확인된다.  
  요청이 오래 걸리면 클라이언트는 요청을 위한 리소스를 오랜 시간 붙잡고 이써야 하고, 서버에서도 마찬가지로 리소스 부족 현상이  
  발생할 수 있다. 이러한 문제를 해결하기 위해 클라이언트는 **시간 제한**을 설정한다.  
  이는 즉 **클라이언트가 요청이 완료될 때까지 기다리는 최대 시간** 이다.

### 재시도

- 실패한 요청을 동일하게 다시 시도했을 때 성공하는 경우도 있지만, *부분적이거나 일시적인 장애*가 더 발생하기 쉽다.

  - **부분적인 장애** : 일정 비율의 요청이 성공하는 것
  - **일시적인 장애** : 잠시 동안 모든 요청이 실패하는 것

- **재시도** : 클라이언트가 동일한 요청을 다시 전송해 부분적인 장애와 단기적인 일시적 장애 상황을 해결하는 방법

- 하지만 재시도가 항상 안전하진 않다. 시스템이 오버로드에 가까워져 이미 장애가 발생한 경우, 재시도로 인해 호출 중인 시스템의  
  로드가 증가할 수 있다. 이러한 문제를 방지하는 방법이 **백오프** 이다. 백오프를 사용하면 장애 이후 수행되는 재시도 간의  
  대기 시간이 증가해 백엔드의 부하가 일정하게 유지된다.

- 시스템 오버로드 뿐만 아니라, 재시도는 일부 원격 호출에 부작용이 수반된다는 문제점이 있다.  
  물론 이를 방지하는 가장 좋은 방법은 **API를 멱등하게 설계하여** 안전하게 재시도할 수 있도록 하는 것이다.

### 지터

- 시스템 부하로 인해 오류가 발생했을 때, 모든 클라이언트가 동시에 재시도하게 되므로 재시도가 비효율적일 수 있다.  
  이를 방지하기 위해 **지터** 를 적용한다.

- **지터** : 임의로 지정한 시간, 이 시간이 지나면 도착률을 분산시켜 대량의 burst를 방지하도록 요청을 작성하거나 재시도하게 된다.

<hr/>
