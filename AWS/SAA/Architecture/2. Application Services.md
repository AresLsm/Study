# Application Services

## Introduction to the SQS(Simple Queue Service)

### What is SQS?

- It is a service that handles the delivery of messages between components.

- SQS is a fully managed service that works with serverless systems, microservices and distributed architectures.
- It has the capability of sending, storing and receiving messages at scale without dropping message data.
- It is possible to configure the service using the AWS Management Console, the AWS CLI or AWS SDKs.

### SQS Components

- Producer
- Queue
- Consumer

- Flow

  - (1) Producer component of your architecture is responsible for sending messages to your queue.
  - (2) SQS services stores the message across a number of SQS servers for resiliency within the specified queue.  
    This ensures that the message remains in the queue should a failure occur with one of the SQS servers.
  - (3) Consumers are responsible for processing the messages within your queue.

- When the consumer element of your architecture is ready to process the massage from the queue, the message is  
  retrieved and is then marked as being _processed_ by **activating the visibility timeout** on the message.  
  This timeout ensures that the same message will not be read and processed by another consumer.  
  When the message has been processed, the consumer then deletes the message from the queue.

#### Visibility Timeout

- When a message is retrieved by a consumer, the **visibility timeout** is started.

- The default time it 30 seconds, and it can be set up to as long as 12 hours.

- If consumer fails to process a message, perhaps due to a communication error, the consumer will not send a  
  delete message request back to SQS. As a result, if the visibility timeout expires and it doesn't receive  
  the request to delete the message, the message will become available again in the queue for other consumers  
  to process. This message will then appear as a new message to the queue.

- **The value of your visibility timeout should be longer than it takes for your consumers to process your messages.**

### SQS Queue Types

- SQS Standard Queue

  - Standard queues support at-least-once delivery of messages.
  - They offer a best effort on trying to preserve the message ordering, but it is not guaranteed.
  - They provide almost unlimited number of TPS.

- SQS FIFO Queues

  - The order of messages is maintained and there are no duplicates.
  - Limited numbers of TPS(default to 300TPS)
  - Batching allows you to perform actions against 10 messages at once with a single action, so  
    when batching, 3000TPS can be achieved.

- Standard vs FIFO

  - Standard
    - Unlimited throughput
    - At-least-once delivery
    - Best-effort ordering
  - FIFO
    - High throughput
    - First In First Out delivery
    - Exactly-once processing

- DLQ(Dead-Letter Queue)

  - The DLQ sends messages that fail to be processed.
  - This could be the result of code within your application, corruption within the message or simply missing information.
  - **If the message can't be processed by a consumer after a maximum number of tries specified,**  
    **the queue will send the message to a DLQ.**
  - By viewing and analyzing the content of the message, it might be possible to identify the problem and ascertain  
    the source of the issue.

  - The DLQ **must have the same queue type as the source it it used against.**

---
