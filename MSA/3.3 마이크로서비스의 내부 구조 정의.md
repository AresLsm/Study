# 마이크로서비스의 내부 구조 정의

<h2>바람직한 마이크로서비스의 내부 아키텍쳐: 클린 마이크로서비스</h2>

- 마이크로서비스의 내부 구조를 정의할 때 반드시 고려해야 할 한 가지는 마이크로서비스 시스템에서 정의해야할  
  마이크로서비스의 내부 구조가 다양할 수 있다는 것이다. 왜냐하면 마이크로서비스는 자율적인 마이크로서비스별 팀에 의한  
  폴리글랏한 내부 구조를 가질 수 있기 때문이다.

- 마이크로서비스 아키텍쳐에서 각 서비스는 각기 목표와 활용도에 따라 명확하게 분리되어야 하고, 각 서비스의 목적에 따라  
  적절한 개발 언어 및 저장소, 내부 아키텍쳐를 정의하는 것이 바람직하다. 조회나 아주 간단한 기능의 경우에는 오히려 굳이  
  헥사고날 아키텍쳐나 클린 아키텍쳐 방식의 구조를 고수할 필요가 없다. 그렇지만 비즈니스 규칙이 복잡한 서비스는  
  고수할 필요성이 분명히 있다.

- 3가지 아키텍쳐(계층형, 헥사고날, 클린)가 지향하는 원칙들을 살펴보자.

  - 지향하는 관심사에 따라 응집성을 높이고 관심사가 다른 영역과는 의존도를 낮추게 해야 한다.
  - 업무 규칙을 정의하는 비즈니스 로직 영역을 다른 기술 기반 영역으로부터 분리하기 위해 노력한다.
  - 세부 기술 중심, 저수준의 외부 영역과 핵심 업무 규칙이 정의된 고수준의 내부 영역으로 구분한다.
  - 고수준 영역은 저수준 영역에 의존하지 않게 해야 하며, 저수준 영역이 고수준 영역에 의존하게 해야 한다.
  - 저수준 영역은 언제든지 교체, 확장 가능해야 하며, 이 같은 변화가 고수준 영역에 영향을 줘서는 안된다.
  - Java처럼 인터페이스 및 추상 클래스를 지원하는 언어의 경우, 저수준 영역의 구체 클래스가 고수준 영역의  
    추상 인터페이스에 의존하게 하는 의존성 역전 원칙을 이용해야 한다.
  - 인터페이스는 고수준의 안정된 영역에 존재해야 하며, 저수준의 어댑터가 이를 구현한다.

- 위 원칙을 준수한 아키텍쳐의 예시 하나를 살펴보자.  
  우선 내부 영역의 맨 안쪽에는 도메인이 존재하고, 서비스가 이 도메인을 감싼다. 도메인에서는 핵심 비즈니스 개념과  
  규칙을 구현하며, 서비스에서는 도메인을 호출해서 업무를 처리하는 절차를 기술한다. 또한 외부 영역과 연계하기 위해  
  서비스 인터페이스를 보유한다. 서비스 인터페이스는 외부에서 내부 영역을 사용할 수 있도록 API를 제공하며,  
  서비스가 이를 구현한다.

- 내부 영역에 있는 또 다른 인터페이스는 저장소 처리를 위한 인터페이스인데, 바로 Repository 인터페이스이다.  
  이 인터페이스는 외부 영역에서 정의하지 않고 내부 영역에서 정의하는데, 비즈니스를 처리하는 데 필요한 기본적인  
  저장소 처리 사항을 추상화해 정의한다. 그렇게 하면 외부 영역의 저장소 어댑터는 이 Repository 인터페이스를  
  각 저장소에 맞는 저장소 처리 세부 기술로 구현하게 된다.

- 외부 영역에는 저장소 처리 어댑터 뿐만 아니라 다양한 Inbound, Outbound를 처리하는 어댑터가 위치한다.  
 이 같이 REST API를 처리하는 어댑터, Event Message를 처리하는 어댑터, Message를 구독하는 Consumer 어댑터,  
 이벤트를 발행하는 어댑터, API 호출 Proxy 어댑터 등의 OutBound Adapter들은 DIP를 적용해 외부 영역에서  
 내부 영역으로 의존하도록 설계한다.
<hr/>

<h2>내부 영역 - 업무 규칙</h2>

- 이제는 각 내부 영역의 구현에 필요한 패턴을 살펴보자. 업무 규칙을 정의하는 내부 영역에는 서비스 인터페이스,  
  서비스 구현체, 도메인, Repository 인터페이스, 도메인 이벤트 인터페이스, API Proxy 인터페이스가 존재한다.

- 서비스 인터페이스는 외부 영역이 내부 영역에 *너무 많이 알지 못하게 하는 역할*을 한다.  
  서비스 인터페이스가 없다면 추이 종석성이 발생할 수 있다.

- Repository 인터페이스, 도메인 이벤트 인터페이스, API Proxy 인터페이스는 DIP를 지원한다.  
  더 안정된 곳인 고수준 영역에 인터페이스가 존재하고, 저수준의 외부 어댑터가 이러한 인터페이스를 구현하게 한다.

- 다음으로 고려해야할 사항은 비즈니스 로직의 핵심인 서비스와 도메인이다.  
  서비스와 도메인은 클린 아키텍쳐의 UseCase와 Entity의 역할과 같다.  
  도메인은 비즈니스 개념을 표현하고, 서비스는 도메인을 활용해 시스템 흐름 처리를 수행한다.

<>
