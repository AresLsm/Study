## 조건문 분해하기

```js
// 리팩토링 적용 전
if (!date.isBefore(plan.summerStart) && !date.isAfter(plan.summerEnd)) {
  charge = quantity * plan.summerRate;
}

// 리팩토링 적용 후
if (summer()) {
  charge = summerCharge();
} else {
  charge = regularCharge();
}
```

### 배경

- 복잡한 조건부 로직은 프로그램을 복잡하게 만드는 가장 흔한 원흉에 속한다. 다양한 조건, 그에 따라  
  동작도 다양한 코드를 작성하면 순식간에 꽤 긴 함수가 탄생한다. 긴 함수는 그 자체로 읽기가 어렵지만,  
  조건문은 그 어려움을 한층 가중시킨다. 조건을 검사하고 그 결과에 따른 동작을 표현하는 코드는 무슨  
  일이 일어나는지는 이야기해주지만, _'왜'_ 일어나는지는 제대로 말해주지 않을 때가 많은 것이 문제다.

- 거대한 코드 블록이 주어지면, 코드를 부위별로 분해한 다음 해체된 코드 덩어리들을 각 덩어리의 의도를  
  살린 이름의 함수 호출로 바꿔주자. 그러면 전체적인 의도가 더 확실히 드러난다. 이렇게 해주면 해당 조건이  
  무엇인지를 강조하고, 그래서 무엇을 분기했는지가 명백해진다. 분기한 이유 역시 더 명확해진다.

- 이 리팩토링은 자신의 코드에 **함수 추출하기**를 적용하는 한 사례라 할 수 있다.

### 절차

- (1) 조건식과 그 조건식에 딸린 조건절 각각을 **함수로 추출** 한다.

### 예시

- 여름철이라면 할인율이 달라지는 어떤 서비스의 요금을 계산한다 해보자.

```js
if (!date.isBefor(plan.summerStart) && !date.isAfter(plan.summerEnd)) {
  charge = quantity * plan.summerRate;
} else {
  charge = quantity * plan.regularRate + plan.regularServiceCharge;
}
```

- 우선 _(1) 조건 부분(조건식)을 별도 함수로 추출하자._

```js
if (summer()) {
  charge = quantity * plan.summerRate;
} else {
  charge = quantity * plan.regularRate + plan.regularServiceCharge;
}

function summer() {
  return !date.isBefore(plan.summerStart) && !date.isAfter(plan.summerEnd);
}
```

- 그런 다음 조건을 만족했을 때의 로직도 또 다른 함수로 추출한다.  
  조건을 만족하지 않았을 때의 로직도 함수로 추출해주자. 사이에 테스트를 해야 한다.

```js
if (summer()) {
  charge = summerCharge();
} else {
  charge = regularCharge();
}

function summer() {
  return !date.isBefore(plan.summerStart) && !date.isAfter(plan.summerEnd);
}

function summerCharge() {
  return quantity * plan.summerRate;
}

function regularCharge() {
  return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

- 취향에 따라 삼항 연산자로 바꿀 수도 있다.

```js
charge = summer() ? summerCharge() : regularCharge();
```

<hr/>

## 조건식 통합하기

```js
// 리팩토링 적용 전
if(employee.seniority < 2) return 0;
if(employee.monthsDisabled > 12) return 0;
if(employee.isPartTime) return 0;

// 리팩토링 적용 후
if(isNotEligibleForDisability()) return 0;

function isNotEligibleForDisability() {
  return (employee.seniority < 2) || (employee.monthsDisabled > 12) || (employee.isPartTime);
```

### 배경

- 비교하는 조건은 다르지만 그 결과로 수행하는 동작은 똑같은 코드들이 더러 있는데, 어짜피 같은 일을 할 거라면 조건 검사도  
  하나로 통합하는게 낫다. 이럴 때 _and_ 연산자나 _or_ 연산자를 사용하면 여러 개의 비교 로직을 하나로 합칠 수 있다.

- 조건부 코드를 통합하는 게 중요한 이유는 두 가지다.  
  첫째, 여러 조각으로 나뉜 조건들을 하나로 통합함으로써 하려는 일이 더 명확해진다. 나눠서 순서대로 비교해도 결과는  
  똑같지만, 읽는 사람은 독립된 검사들이 우연히 함께 나열된 것으로 오해할 수 있다.  
  둘째, 이 작업은 **함수 추출하기**까지 이어질 가능성이 높다. 복잡한 조건식을 함수로 추출하면 코드의 의도가  
  훨씬 분명하게 드러나는 경우가 많다. 함수 추출하기는 _'무엇'_ 을 하는지를 기술하던 코드를  
  _'왜'_ 하는지를 말해주는 코드로 바꿔주는 효과적인 도구임을 기억하자.

### 절차

- (1) 해당 조건식들 모두에 부수 효과가 없는지 확인한다.  
  부수효과가 있는 조건식들에는 **질의 함수와 변경 함수 분리하기**를 적용한다.
- (2) 조건문 두 개를 선택해서 두 조건문의 조건식들을 논리 연산자로 결합한다.  
  순차적으로 이뤄지는 조건문은 or로, 중첩된 조건문은 and로 결합한다.
- (3) 테스트한다.
- (4) 조건이 하나만 남을 때까지 `(2)` ~ `(3)`을 반복한다.
- (5) 하나로 합쳐진 조건식을 **함수로 추출**할지 고려해본다.

### 예시: or 사용하기

- 아래와 같은 코드를 발견했다 해보자.

```js
function disabilityAmount(employee) {
  if (employee.seniority < 2) {
    return 0;
  }
  if (employee.monthsDisabled > 12) {
    return 0;
  }
  if (employee.isPartTime) {
    return 0;
  }
  // 장애 수당 계산
}
```

- 똑같은 결과로 이어지는 조건 검사가 순차적으로 진행되고 있다.  
  _(2) 결과로 행하는 동작이 같으므로 이를 하나의 식으로 결합해보자._  
  순차적인 경우이므로 or 연산자를 이용하면 된다.

```js
function disabilityAmount(employee) {
  if (employee.seniority < 2 || employee.monthsDisabled > 12) {
    return 0;
  }
  if (employee.isPartTime) {
    return 0;
  }
  // 장애 수당 계산
}
```

- _(3) 테스트_ 한 후 _(4) 그 다음 조건에도 적용_ 한다.

```js
function disabilityAmount(employee) {
  if (
    employee.seniority < 2 ||
    employee.monthsDisabled > 12 ||
    employee.isPartTime
  ) {
    return 0;
  }
  // 장애 수당 계산
}
```

- 이제 _(5) 모든 조건을 통합했다면 최종 조건식을 함수로 추출할_ 수 있다.

```js
function disabilityAmount(employee) {
  if (isNotEligibleForDisability()) return 0;
  // 장애 수당 계산

  function isNotEligibleForDisability() {
    return (
      employee.seniority < 2 ||
      employee.monthsDisabled > 12 ||
      employee.isPartTime
    );
  }
}
```

### 예시: and 사용하기

- 앞의 예시에서는 조건식들을 or 연산자로 결합하는 모습을 봤는데, if문이 중첩되어 나오면 and를 사용해야 한다.

```js
if (employee.onVacation) {
  if (employee.seniority > 10) {
    return 1;
  }
}
```

- 이 조건들을 and 연산자로 결합해보자.

```js
if (employee.onVacation && employee.seniority > 10) return 1;
else return 0.5;
```

<hr/>
