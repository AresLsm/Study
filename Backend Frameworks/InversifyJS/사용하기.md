# InversifyJS 사용하기

- 우선 아래 코드 예시는 Express + TypeScript로 작성된 백엔드 애플리케이션의 일부 코드이다.

<h2>시나리오</h2>

- 사용자와 관련된 컨트롤러에서 사용자와 관련된 서비스 코드를 호출해야 한다.

<hr/>

<h2>설정하기</h2>

- 우선 Inversify 패키지를 패키지 매니저로 설치하고, 아래 설정을 해준다.  
  Inversify가 제공할 컨테이너에 대한 설정을 해줄 수 있는데, 나는 이러한 설정 파일을 개인적으로  
  `config`라는 폴더 하위에 모아놓는 습관이 있어서, 아래처럼 설정했다.

- 아래 파일은 Inversify Container에서 어떤 것을 가져올지를 정의한 파일이다.

```ts
// src/config/types.ts
const TYPES = {
  UserRepository: Symbol.for("UserRepository"),
  UserService: Symbol.for("UserService"),
};

export default TYPES;
```

- 추후에 어떻게 사용되는지 보면 이해할 수 있을 것이다.  
  참고로 `Symbol.for(..)`를 사용한 이유는 Inversify 문서에서 이를 권장하기 때문이다.

- 한 가지 설정을 더 해줘야 하는데, 실제 런타임에 의존성 주입을 할 때 인터페이스의 어떤 구현체가  
  주입될지를 정의한 파일이 필요하다.

```ts
// src/config/inversify.config.ts
import { Container } from "inversify";
import { UserRepository } from "users/domain";
import { UserService, UserServiceImpl } from "users/service";
import TYPES from "./types";

const container = new Container();

container.bind<UserRepository>(TYPES.UserRepository).to(UserRepository);
container.bind<UserService>(TYPES.UserService).to(UserServiceImpl);

export default container;
```

- 위 코드 예시에서 `UserRepository`는 따로 추상화가 이루어지지 않은 DAO Layer의 코드이다.  
  서비스 인터페이스를 제공하는 것은 `UserService` 뿐인데, 이후 `UserService`가 필요한  
  클라이언트 코드에서 이제 InversifyJS의 container에서 `TYPES.UserService`로  
  구현체인 `UserServiceImpl`을 주입받아 사용할 수 있게 된다.

- 한 가지 중요한 점은, 위 2개의 설정 파일 모두 `default export`를 사용해야 한다는 점이다.  
  `export const ~` 또는 `export {..}`를 사용하면 이유는 모르겠지만 동작하지 않는다.

<hr/>
