선택 위젯 만들기
======

<h2>나인패치 이미지</h2>

* `ImageView`를 XML Layout에 추가해서 화면에 보여줄 때, 단말의 해상도 또는 크기에 따라 사진의 크기가 시스템에 의해 결정되며   
  이 경우 이미지의 일부분이 깨져 보이거나 왜곡이 발생할 수 있다.   
  이렇게 이미지가 단말마다 변하는 것을 방지하는 것이 `Nine Patch` 이다. 이는 간단히 말하면 이미지가 늘어나거나 줄어들 때   
  발생하는 이미지 왜곡을 해결하는 방법을 정의한 것이다.

* Nine Patch 이미지는 `xxx.9.png` 처럼 파일 확장자 앞에 `.9`를 붙여야 한다. 안드로이드에서는 이 방식으로 이름을 지은   
  파일을 원본 이미지의 가로, 세로 끝부분의 픽셀을 모두 나인패치 이미지의 정보를 담은 것으로 인식한다.   
  이 정보는 흰색인 경우 늘어나지 않는 영역, 검은색인 경우 늘어나는 영역으로 구분되는데, 이 성질을 통해 이미지의   
  크기가 커지더라도 모서리 부분이 원래의 이미지 모양을 유지할 수 있게 된다.
<hr/>

<h2>새로운 View 만들기</h2>

* API에서 제공하는 위젯을 사용하면 거의 대부분의 화면을 만들 수 있지만, 특정 기능을 가진 위젯을 따로 구상해야할 때는   
  새로운 View나 Widget을 만들어야 한다.

* API에서 제공하는 View를 사용하려면 API의 View를 상속해야 한다. 그리고 API의 View를 상속하여 새로운 View를 만들때는   
  View가 그려지는 방법을 반드시 이해해야 한다. View의 영역과 크기는 그 View를 포함하는 layout의 영향을 받아 정해진다.   
  이때 개발자가 View의 상태에 따라 추가적인 코드를 넣을 수 있도록 callback메소드가 호출되는데, 메소드는 아래와 같다.
```java
public void onMeasure(int widthMeasureSpec, int heightMeasureSpec);
public void onDraw(Canvas canvas);
```
* `onMeasure()` 메소드는 View가 스스로의 크기를 정할 때 자동으로 호출된다. 파라미터로 전달되는 두 개의 값은   
  이 View를 담고 있는 layout에서 이 View에게 허용하는 여유 공간의 폭과 높이에 대한 정보이다.   
  즉, 부모 컨테이너에서 여유 공간에 대한 정보를 전달하는데 이 값을 참조하여 View가 보일 적절한 크기를 지정하면   
  이 크기값으로 View가 그려지게 된다. `onMeasure()` 메소드 내에서 이 View를 담고 있는 layout에게 이 View의 크기값을   
  반환하고 싶다면 아래 메소드를 사용하면 된다.
```java
void setMeasuredDimension(int measuredWidth, int measuredHeight);
// measuredWidth : View의 폭, measuredHeight : View의 높이
```
* `onDraw()` 메소드는 Vew가 스스로를 layout에 맞게 그릴 때 자동으로 호출된다.
<hr/>

<h3>onDraw()와 invalidate() 메소드의 이해</h3>

* View가 화면에 보일 때에는 `onDraw()` 메소드가 호출된다. 예를들어 버튼의 경우, 그림으로 된 아이콘이나 글자가   
  그 위에 표시되려먼 먼저 그 버튼을 담고 있는 layout에 따라 버튼의 위치와 크기가 정해져야 한다. 그런 다음 버튼의 모양과   
  그 안의 아이콘 또는 글자를 화면상에 그려주는 과정을 거치게 된다. 이렇게 그려지는 과정에서 `onDraw()` 메소드를   
  재정의하면 개발자가 보여주려는 내용물을 버튼 위에 그릴 수 있게 된다.
* 결국 새로운 View를 클래스로 정의하고, 그 안에 `onDraw()` 메소드를 재정의한 후 필요한 코드를 넣어 기능을 구현하면   
  다른 모양으로 보이는 View를 직접 만들 수 있다. 만약 손가락으로 터치하여 화면에 그려진 View를 이동시키려 할때는   
  View가 이동한 후에 그 View의 그래픽을 다시 그려야할 필요가 있는데, 이때 `invalidate()` 메소드를 호출한다.   
  `invalidate()` 메소드가 호출되면 자동으로 `onDraw()` 메소드가 다시 호출되어 이동한 좌표에 View의 그래픽을 다시 그리도록할 수 있다.

* 새로운 프로젝트(View) 생성 후, `com.techtown.view`에 `MyButton.java` 파일을 생성하고, 이 클래스는 `AppCompatButton`를   
  상속하도록 한다. `AppCompatButton`에는 버튼을 위한 기능들이 미리 정의되어 있으며, `android.support.v7.widget`패키지에 있다.   
```java
public class MyButton extends AppCompatButton {
    
    // 필수 생성자 1
    public MyButton(Context context) {
        super(context);
    }

    // 필수 생성자 2
    public MyButton(Context context, AttributeSet attrs) {
        super(context, attrs);
    }
    
    private void init(Context context) {
        setBackgroundColor(Color.CYAN);
        setTextColor(Color.BLACK);
        
        float textSize = getResources().getDimension(R.dimen.text_size);
        setTextSize(textSize);
    }
}
```
* 안드로이드는 UI 객체를 만들 때 `Context` 객체를 전달받게 되어있으므로 생성자에는 항상 `Context`객체가 전달돼야 한다.   
  `AttributeSet`객체는 XML Layout에서 태그에 추가하는 속성을 전달받기 위한 것으로, 이 View를 XML Layout에 추가하는 경우에는   
  필수 생성자 2가 호출된다.
* `init()` 메소드는 생성자가 2개이므로 사용자가 정의한 메소드인데, 이 메소드는 View의 배경색, 글자색, 그리고   
  텍스트의 크기를 설정했다. 위 코드에서 textSize값을 직접 지정하지 않은 이유는 직접 지정하면 px단위 설정만 가능하기 때문이다.   
  `R.dimen.text_size`에서 값을 읽어와야 하므로 `app/res/values`의 하위에 `dimens.xml`파일을 추가하자.
```xml
<!-- dimens.xml -->
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <dimen name="text_size">16sp</dimen>
</resources>
```
* 이제 위에서 `<dimen>` 태그에 name을 text_size로 지정하고, 값을 16sp로 지정했으므로 Java코드에서 이 값을 참조할 수 있다.   
  소스 코드에서 이 값을 참조할 때에는 `Resources#getDimension()` 메소드로 참조할 수 있다.   
  다음으로는 `MyButton.java`에 `onDraw()`와 `onTouchEvent()` 메소드를 재정의해보자.
```java
// MyButton.java

@Override
protected void onDraw(Canvas canvas) {
    super.onDraw(canvas);
    Log.d("MyButton", "onDraw() called.");
}

@Override
public boolean onTouchEvent(MotionEvent event) {
    Log.d("MyButton", "onTouchEvent() called.");
    int action = event.getAction();
    switch(action) {
        case MotionEvent.ACTION_DOWN:
            setBackgroundColor(Color.BLUE);
            setTextColor(Color.RED);
            break;
        case MotionEvent.ACTION_OUTSIDE:
        case MotionEvent.ACTION_CANCEL:
        case MotionEvent.ACTION_UP:
            setBackgroundColor(Color.CYAN);
            setTextColor(Color.BLACK);
            break;
    }
    
    invalidate();
    return true;
}
```
* 위에서 `onTouchEvent()` 메소드는 손가락이 눌린 상태를 검사하여, 손가락이 눌렸을 때 배경색과 글자색이 바뀌었다면   
  `invalidate()` 메소드를 호출하여 View를 다시 그린다. `invalidate()`는 호출되면 `onDraw()`를 자동으로 호출한다 했다.
<hr/>

<h2>Layout 정의하고 CardView 넣기</h2>

* View들을 담아두는 Layout을 상속해서 새로운 Layout을 만들어보자. 그리고 이 안에 `CardView`를 넣어보자.   
  `CardView`는 프로필과 같은 간단한 정보를 넣기 위해 각 영역을 구분하는 역할을 한다.

* `/app/res/layout`에 `layout1.xml` 파일을 추가하고, 아래와 같이 입력하자.
```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="wrap_content">

    <ImageView
        android:id="@+id/imageView"
        android:layout_width="80dp"
        android:layout_height="80dp"
        android:src="@mipmap/ic_launcher"/>
   <LinearLayout
       android:layout_width="match_parent"
       android:layout_height="wrap_content"
       android:orientation="vertical"
       android:layout_margin="5dp">

       <TextView
           android:id="@+id/textView"
           android:layout_width="match_parent"
           android:layout_height="wrap_content"
           android:text="이름"
           android:textSize="30sp" />
        <TextView
            android:id="@+id/textView2"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:textSize="25sp"
            android:textColor="#FF0000FF"
            android:text="전화번호"
            />
    </LinearLayout>
</LinearLayout>
```
* 그리고 이 XML Layout과 매칭될 Java 클래스 파일을 만들자.
```java
public class Layout1 extends LinearLayout {
    
    ImageView imageView;
    TextView textView;
    TextView textView2;
    
    public Layout1(Context context) {
        super(context);
    }

    public Layout1(Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
    }
    
    private void init(Context context){
        LayoutInflater inflater = (LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        inflater.inflate(R.layout.layout1, this, true);
        
        imageView = findViewById(R.id.imageView);
        textView = findViewById(R.id.textView);
        textView2 = findViewById(R.id.textView2);
    }
    
    public void setImage(int resId) {
        imageView.setImageResource(resId);
    }
    
    public void setName(String name) {
        textView.setText(name);
    }
    
    public void setMobile(String mobile) {
        textView2.setText(mobile);
    }
}
```
* `init()` 메소드 내에서는 `LayoutInflater`객체를 참조했는데, 이는 시스템 서비스로 제공되므로 `getSystemService()` 메소드를   
  호출하면서 인자로 `Context.LAYOUT_INFLATER_SERVICE`상수를 전달하여 `LayoutInflater`객체를 반환받았다.   
  이 객체의 `inflate()` 메소드를 호출하면서 XML Layout 파일을 파라미터로 전달하면 inflation이 진행되면서 이 소스파일에 설정된다.

* ImageView에 보이는 이미지를 바꿀 수 있는 메소드중 하나가 `setImageResource()` 메소드인데, 이 메소드는 `app/res/drawable`   
  폴더안에 들어있는 이미지 파일을 참조하는 정수 값을 파라미터로 받는다. 이 폴더내의 이미지 파일은 정수값으로 표현되는   
  리소스id로 참조할 수 있다.

* 이제 만들어놓은 layout1을 Main Activity에 추가해보자.
* 아래는 `activity_main.xml` 코드이다.
```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity">

    <com.techtown.layout.Layout1
        android:id="@+id/layout1"
        android:layout_width="match_parent"
        android:layout_height="wrap_content">
        
    </com.techtown.layout.Layout1>

</LinearLayout>
```
* 다음으로는 `MainActivity.java` 파일을 작성하자.
```java
public class MainActivity extends AppCompatActivity {

    Layout1 layout1;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        
        layout1 = findViewById(R.id.layout1);
        layout1.setImage(R.drawable.ic_launcher_foreground);
        layout1.setName("나상우");
        layout1.setMobile("010-1234-1234");
        
        Button button = findViewById(R.id.button);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                layout1.setImage(R.drawable.profile1);
            }
        });
        
        Button button2 = findViewById(R.id.button2);
        button2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                layout1.setImage(R.drawable.profile2);
            }
        });
    }
}
```
* 위 코드는 버튼 클릭 시 보이는 이미지를 변경한다.

* 이제 만든 Layout1의 모양을 CardView의 모양으로 바꿔보자. CardView는 다른 View들을 담고 있는 layout의 테두리를   
  카드 모양으로 둥글게 바꿔준다. 
```xml
<!-- layout1.xml -->
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="wrap_content">
    
    <androidx.cardview.widget.CardView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        app:cardBackgroundColor="#FFFFFFFF"
        app:cardCornerRadius="10dp"
        app:cardElevation="5dp"
        app:cardUseCompatPadding="true">
        
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal">
            
            <ImageView
                android:id="@+id/imageView"
                android:layout_width="80dp"
                android:layout_height="80dp"
                android:src="@mipmap/ic_launcher"/>
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:orientation="vertical"
                android:layout_weight="1"
                android:layout_margin="5dp">

                <TextView
                    android:id="@+id/textView"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="이름"
                    android:textSize="30sp" />
                <TextView
                    android:id="@+id/textView2"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:textSize="25sp"
                    android:textColor="#FF0000FF"
                    android:text="전화번호"
                    />
            </LinearLayout>
            
        </LinearLayout>
    </androidx.cardview.widget.CardView>
</LinearLayout>
```
<hr/>

<h2>RecyclerView 만들기</h2>

* 