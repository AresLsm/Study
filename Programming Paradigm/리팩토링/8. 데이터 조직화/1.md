## 변수 쪼개기

```js
// 리팩토링 적용 전
let temp = 2 * (height * width);
console.log(temp);
temp = height * width;
console.log(temp);

// 리팩토링 적용 후
const perimiter = 2 * (height + width);
console.log(permiter);
const area = height * width;
console.log(area);
```

### 배경

- 변수는 다양한 용도로 쓰인다. 그중 변수에 값을 여러 번 대입할 수 밖에 없는 경우도 있다.  
  예를 들어 반복문 `for(let i = 0; i < 10; i++)`에서 변수 i와 같은 loop 변수는  
  반복문을 한 번 돌 때마다 값이 바뀐다. 수집 변수(collecting variable)는 메소드가  
  동작하는 중간중간 값을 저장한다.

- 그 외에도 변수는 긴 코드의 결과를 저장했다가 나중에 쉽게 참조하려는 목적으로 흔히 쓰인다.  
  이런 변수에는 값을 단 한 번만 대입해야 한다. 대입이 두 번 이상 이루어진다면 여러 가지 역할을  
  수행한다는 신호다. **역할이 둘 이상인 변수가 있다면 쪼개야 한다. 예외는 없다.** 역할 하나당  
  변수 하나다. 여러 용도로 쓰인 변수는 코드를 읽는이에게 커다란 혼란을 주기 때문이다.

### 절차

- (1) 변수를 선언한 곳과 값을 처음 대입하는 곳에서 변수명을 바꾼다.  
  이후의 대입이 항상 `i = i + 뭔가` 형태라면 수집 변수이므로 쪼개면 안된다.  
  수집 변수는 총합 계산, 문자열 연결, Stream에 쓰기, 컬렉션에 추가하기 등의 용도로 흔히 쓰인다.

- (2) 가능하면 이때 불변(immutable)으로 선언한다.

- (3) 이 변수에 두 번째로 값을 대입하는 곳 앞까지의 참조(이 변수가 쓰이는 곳)를 새로운 변수명으로 바꾼다.

- (4) 두 번째 대입 시 변수를 원래 이름으로 다시 선언한다.

- (5) 테스트한다.

- (6) 반복한다. 매 반복에서 변수를 새로운 이름으로 선언하고 다음번 대입 때까지의 모든 참조를 새로운  
  변수명으로 바꾼다. 이 과정을 마지막 대입까지 반복한다.

### 예시

- 이번 예시에서는 haggis라는 음식이 다른 지역으로 전파된 거리를 구하는 코드를 볼 것이다.  
  Haggis가 발상지에서 초기 힘을 받아 일정한 가속도로 전파되다가, 시간이 흐른 후 어떠한 계기로  
  두 번째 힘을 받아 전파 속도가 빨라진다고 가정해보자. 이를 일반적인 물리 법칙을 적용해 전파 거리를  
  아래와 같이 계산했다.

```js
function distanceTravelled(scenario, time) {
  let result;
  let acc = scenario.primaryForce / scenario.mass;
  let primaryTime = Math.min(time, scenario.delay);
  result = 0.5 * acc * primaryTime * primaryTime; // 전파된 거리
  let secondaryTime = time - scenario.delay;
  if (secondaryTime > 0) {
    let primaryVelocity = acc * scenario.delay;
    acc = (scenario.primaryForce + scenario.secondaryForce) / scenario.mass;
    result +=
      primaryVelocity * secondaryTime +
      0.5 * acc * secondaryTime * secondaryTime;
  }
  return result;
}
```

- 괜찮아 보이는 작은 함수가 만들어졌다. 이 예시에서 흥미로운 부분은 acc 변수에 값이 두 번 대입된다는 점이다.  
  이는 곧 역할이 두 개라는 신호다. 하나는 첫 번째 힘이 유발한 초기 가속도를 저장하는 역할이고, 다른 하나는  
  두 번째 힘까지 반영된 후의 가속도를 저장하는 역할이다. 쪼개야할 변수다.

- 첫 단계로 _(1) 변수에 새로운 이름을 지어주고, (2) 선언 시 const를 붙여 불변으로 만들자._  
  그 다음 _(3) 두 번째 대입 전까지의 모든 참조를 새로운 이름으로 바꾼다._ 마지막으로
  - 두 번째로 대입할 때 변수를 다시 선언한다.\*

```js
function distanceTravelled(scenario, time) {
  let result;
  const primaryAcceleration = scenario.primaryForce / scenario.mass; // (1), (2)
  let primaryTime = Math.min(time, scenario.delay);
  result = 0.5 * primaryAcceleration * primaryTime * primaryTime; // (3)
  let secondaryTime = time - scenario.delay;
  if (secondaryTime > 0) {
    let primaryVeloctiy = primaryAcceleration * scenario.delay;
    let acc = (scenario.primaryForce + scenario.secondaryForce) / scenario.mass; // (4)
    result +=
      primaryVeloctiy * secondaryTime +
      0.5 * acc * secondaryTime * secondaryTime;
  }
  return result;
}
```

- 수정한 코드를 보면 (1)에서 변수의 첫 번째 용도만을 대표하는 이름을 선택했음을 알 수 있다.  
  그리고 const로 선언해 값을 다시 대입하지 못하도록 했다. 그리고 두 번째 대입하는 곳(4)에서 변수를  
  원래 이름으로 다시 선언했다. 이제 컴파일하고 테스트하고 잘 동작하는지 확인하자.

- 다음으로 _(6) 두 번째 대입을 처리_ 할 차례다. 이번에는 두 번째 용도에 적함한 이름으로 수정하므로  
  이 변수의 원래 이름(acc)는 완전히 사라지게 된다.

```js
function distanceTravelled(scenario, time) {
  let result;
  const primaryAcceleration = scenario.primaryForce / scenario.mass;
  let primaryTime = Math.min(time, scenario.delay);
  result = 0.5 * primaryAcceleration * primaryTime * primaryTime;
  let secondaryTime = time - scenario.delay;
  if (secondaryTime > 0) {
    let primaryVelocity = primaryAcceleration * scenario.delay;
    const secondaryAcceleration =
      (scenario.primaryForce + scenario.secondaryForce) / scenario.mass;
    result +=
      primaryVelocity * secondaryTime +
      0.5 * secondaryAcceleration * secondaryTime * secondaryTime;
  }
  return result;
}
```

### 예시: 입력 매개변수의 값을 수정할 때

- 변수 쪼개기의 또 다른 예시로 입력 매개변수를 생각해볼 수 있다.  
  아래 코드를 보자.

```js
function discount(inputValue, quantity) {
  if (inputValue > 50) inputValue = inputValue - 2;
  if (quantity > 100) inputValue = inputValue - 1;
  return inputValue;
}
```

- 여기서 inputvalue는 함수에 데이터를 전달하는 용도와 결과를 호출자에게 반환하는 두 개의 용도로  
  쓰였다. 이 상황이라면 먼저 아래와 같이 inputValue를 쪼개야 한다.

```js
function discount(originalInputValue, quantity) {
  let inputValue = originalInputValue;
  if (inputValue > 50) inputValue = inputValue - 2;
  if (quantity > 100) inputValue = inputValue - 1;
  return inputValue;
}
```

- 그런 다음 **변수 이름 바꾸기**를 두 번 수행해서 각각의 쓰임새에 어울리는 이름을 지어주자.

```js
function discount(inputValue, quantity) {
  let result = inputValue;
  if (result > 50) result = result - 2;
  if (quantity > 100) result = result - 1;
  return result;
}
```

<hr/>
