<h1>JPQL</h1>

* JPQL은 JPA Query Language의 약자로 JPA에서 사용하는 query언어이다. JPQL의 문법은 SQL문법과 매우 유사하다. 차이점이 있다면   
  __테이블과 컬럼명 대신 매핑한 Entity이름과 속성 이름을 사용한다__ 는 점이다.

```java
TypedQuery<Review> query = entityManager.createQuery(
    "SELECT r FROM Review r WHERE r.hotel = :hotel ORDER BY r.id DESC", Review.class);
query.setParameter("hotel", hotel);
query.setFirstResult(0);
query.setMaxResults(3);

List<Review> reviews = query.getResultList();
```
<hr/>

<h2>JPQL 기본 코드</h2>

* JPQL의 기본 구조는 다음과 같다.
```sql
SELECT 별칭 FROM Entity이름 AS 별칭
```

* from절 뒤의 Entity이름은 `@Entity`를 적용한 클래스의 이름이다. 별칭은 JPQL에서 Entity를 참조할 때 사용하는 이름이다.   
  __별칭은 필수__ 이며, select 절은 선택할 대상을 지정한다. select 대상으로 Entity의 별칭을 지정하면, 해당 Entity를 선택한다.

* 아래는 모든 `User` Entity를 선택하는 JPQL의 예시이다.
```sql
SELECT u FROM User AS u;
SELECT u FROM User u;
SELECT user FROM User user;
```

* JPQL을 실행하려면 `EntityManager#createQuery()` 메소드로 `Query`를 생성해야 한다. SELECT의 결과 타입을 알고 있는 경우엔   
  `EntityManager#createQuery(String, Class)` 메소드를 이용해서 `javax.persistence.TypedQuery` 객체를 생성한다. 예를 들어   
  select의 결과가 `User` 타입이라면 아래와 같이 `createQuery()`의 두 번째 인자의 값으로 `User.class`를 전달한다.
```java
TypedQuery<User> query = entityManager.createQuery("SELECT u FROM User u", User.class);
List<User> users = query.getResultList();
```
  * `TypedQuery#getResultList()` 메소드는 JPQL에 해당하는 SQL문을 실행하고 그 결과를 반환한다. 위 코드에서는 SELECT절에서 `User`   
    타입을 선택했으므로 query의 결과로 `User` Entity를 담은 리스트를 반환한다.

* `EntityManager#createQuery(String)` 메소드를 이용해서 `javax.persistence.Query` 객체를 생성할 수도 있다.
```java
Query query = entityManager.createQuery("SELECT u FROM User u");
List users = query.getResultList();
```

* 조회 대상 타입을 지정하는 `TypedQuery`와는 달리 `Query`는 선택 타입을 지정하지 않는다. 이런 이유로 `Query#getResultList()`로 구한   
  List에서 데이터를 구할 때에는 알맞게 타입을 변환해주어야 한다.

<h3>ORDER BY를 이용한 정렬</h3>

* order by 절을 이용하면 정렬 순서를 지정할 수 있다. 정렬 순서를 지정할 때는 Entity의 속성을 사용한다. Entity의 속성은 "별칭.속성"의   
  형식으로 지정한다. 아래 코드는 order by절을 사용한 JPQL의 예시이다.
```sql
SELECT p FROM Player p ORDER BY p.name ASC;
SELECT p FROM Player p ORDER BY p.name;
SELECT p FROM Player p ORDER BY p.name DESC;
```

* 오름차순과 내림차순의 정렬은 각각 ASC와 DESC로 지정한다. SQL과 마찬가지로 정렬 순서를 생략하면 오름차순을 사용한다.

* 두 개 이상의 속성을 사용해서 정렬하고 싶다면 콤마로 구분한다.
```sql
SELECT p FROM Player p ORDER BY p.team.id, p.name;
```

* 만약 `Player`가 `Team`을 `@ManyToOne`으로 참조하고 있고, `@JoinColumn(name = "team_id")`가 적용되어 있다면, 위 JPQL은 아래의   
  SQL문을 실행한다.
```sql
SELECT p.player_id, ...생략 FROM Player p ORDER BY p.team_id, p.name;
```

* 연관 객체의 식별자뿐만 아니라 다른 속성도 ORDER BY 절에서 사용할 수 있다.
<hr/>

<h2>검색 조건 지정</h2>
