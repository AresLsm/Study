# 비즈니스 로직(관심사)의 분리

- 소프트웨어의 핵심은 비즈니스 로직이다.  
  개발자의 역할은 문제 영역의 비즈니스 로직을 분석 및 이해하고 프로그래밍 언어로 표현하는 것이다.  
  여기서 잘 표현한다는 것은 기능이 잘 동작하는 것과 더불어 이해하기 쉽고 변경하기 쉬운 시스템을 만드는 것을 의미한다.

- 설계 원칙 중 관심사의 분리(Seperation of Concerns) 원칙이 있다. 이는 시스템의 각 영역이 처리하는  
  관심사가 분리되어 잘 관리돼야 한다는 의미이고, 이 원칙은 시스템을 이해하고 변경하기 쉽게 만들어 준다.  
  이 원칙에 따라 각 영역은 고유 관심사에 의해 분리되고 집중돼야 한다.

- 모듈화 및 계층화도 이 원칙에 기인한다. 특히 비즈니스를 표현하는 비즈니스 로직 영역과 기술 문제를 처리하는  
  기술 영역은 철저히 분리하는 것이 좋다. 이것은 비즈니스 로직이 기술보다는 오랫동안 지속되고 안정적이어야 할  
  애플리케이션의 핵심 영역이기에 기술에 영향을 적게 받도록 설계하는 것을 강조한 데서 기인한다.

- 기술과 비즈니스 로직을 분리했을 때 복잡성이 낮아지고 유지보수성도 높아진다.  
  특히 객체지향 분석 설계(OOAD: Object Oriented Analysis and Design)에서는 비즈니스 로직을  
  누가봐도 쉽게 이해하기 쉽게 구조화하는 객체 모델로 표현하는 것을 강조해 왔다.

- 유연하고 확장성 있는 MSA 시스템을 만들기 위해서는 각 마이크로서비스의 관계들을 유연하게 만들어주는  
  MSA 외부 아키텍쳐 및 패턴도 중요하지만 마이크로서비스의 내부 구조를 어떻게 유연하게 만들것인지도 중요하다.

<h2>데이터베이스 중심 아키텍쳐의 문제점</h2>

- 일반적으로 빈번하게 사용하는 데이터 중심의 서비스 내부 구조를 구현하는 방식을 알아보자.  
  `데이터베이스 중심 아키텍쳐`란 특정 RDBMS에 의존한 데이터 모델링을 수행한 다음, 이 물리 테이블 모델을  
  중심에 두고 애플리케이션을 구현하기 위한 사고를 하는 방식이다.

- Spring을 예로 들어 애플리케이션이 Controller, Service, DB I/O, DTO로 크게 구성되며, 데이터 처리는 MyBatis를  
  사용한다고 가정해보자. 이러한 구조에서 일반적으로 비즈니스 로직은 서비스에 의존해야 한다고 말하지만, 서비스에 존재하게 될 로직은  
  흐름 제어 로직밖에 없다. 그 밖의 비즈니스 개념과 규칙들은 테이블과 SQL 질의에 존재한다.  
  DTO는 질의를 통해 가져오는 정보를 담아주는 역할밖에 할 수 없다.

- 이 구조는 이후에 살펴볼 애플리케이션 로직 구성 패턴 중 하나인 트랜잭션 스크립트 구조와 유사한데, 간단한 처리 로직의 경우에는  
  편리하지만, 업무가 복잡해지면 점점 복잡성을 제어할 수 없게 된다는 단점이 있다. 또한 업무 개념이 특정 저장 기술인 RDBM의  
  테이블로 표현되고, 업무가 복잡해질수록 업무 규칙이 SQL과 섞여 표현된다.

- 비즈니스 민첩성을 위해서는 유연성과 확장성이 중요하다. 예를 들어, 비즈니스 특정 기능을 위해 NoSQL로 교체하게 되었다고 하자.  
  그런데 이러한 시스템에서는 저장소를 변경하려 해도 쉽게 변경할 수가 없다. 왜냐하면 저장 기술과 비즈니스 로직이 끈끈하게 붙어 있기  
  때문에 저장소를 변경했을 때 모든 것을 다시 구현해야 한다고 개발팀이 판단했기 때문이다.

- 또한 데이터베이스 중심 아키텍쳐의 성능 측면을 보면, 이 같은 구조에서는 대부분의 성능을 데이터베이스에 의존한다.  
  서비스의 비즈니스 개념과 규칙이 대부분 데이터베이스에 표현되기 때문이며, 애플리케이션에서는 별로 할 일이 없다.  
  따라서 데이터가 늘어남에 따라 데이터베이스의 성능은 지속적으로 떨어지게 되고, 이를 최적화할 방법으로 데이터베이스 서버의 사양과  
  용량을 계속 증가시키고 Query문 튜닝에 몰두할 수 밖에 없다. 앞서 클라우드 인프라를 사용할 때의 가장 큰 장점인 사용량에  
  유연하게 대응할 수 있는 Scale Out의 의미가 없어진다.

- 데이터베이스의 본질은 데이터의 저장이며, 여기에 최적화되어 있다. SQL도 비즈니스 로직을 처리하기 위한 언어가 아니라  
  데이터 처리를 위한 언어이다. Storage가 비싸고 한정적인 온프레미스 환경에선 최적의 성능을 발휘하기 위해 데이터베이스 중심의  
  아키텍쳐가 필요했던 시기가 있었다. 하지만 클라우드 환경에서는 필요한 만큼 인프라를 유연하게 이용할 수 있고, 저장 기술 또한  
  선택지가 다양하다. 이전처럼 웹과 RDBMS만 고려해야하는 상황도 아니다. 웹, 모바일, CLI 등 여러 디바이스의 I/O를  
  지원해야 하고, RDBMS, Memory DB, NoSQL, Message Queue까지 다양한 저장소와의 연계가 필요하다.

- 즉, 클라우드의 풍부한 자원 환경에서는 애플리케이션 자체의 성능 보다는 애플리케이션의 확장성과 유연함이 더 중요하다.  
 따라서 끈끈하게 결합되어 있던 비즈니스 로직 처리와 데이터 처리는 관심사 분리 원칙에 따라 철저히 분리해야 한다.
<hr/>
