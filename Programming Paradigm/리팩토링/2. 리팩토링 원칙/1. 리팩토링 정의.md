# 리팩토링 정의

- 수많은 다른 소프트웨어 개발 용어와 마찬가지로 리팩토링도 엔지니어들 사이에서 두루뭉실한 의미로 통용된다.  
  하지만 저자는 리팩토링이라는 단어를 명사, 동사의 2개로 구분하여 정의한다.

> 리팩토링(명사): 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법

- 앞에서 살펴본 **함수 추출하기**, **조건부 로직을 다형성으로 바꾸기** 처럼 이름 붙은 리팩토링 기법들이  
  이 정의에 해당한다.

> 리팩토링(동사): 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩토링 기법을 적용해서 소프트웨어를 재구성함

- 예를 들어 두 버전의 용어를 한 문장에 담으면 아래처럼 기술할 수도 있다.  
  _앞으로 몇 시간은 리팩토링할 것 같은데, 그 사이에 적용하는 리팩토링은 수십 가지나 될 것 같다._

- 위 정의에 따르면 특정한 방식에 따라 코드를 정리하는 것만이 리팩토링이다.  
  리팩토링은 결국 동작을 보존하는 작은 단계들을 거쳐 코드를 수정하고, 이러한 단계들을 순차적으로 연결하여  
  큰 변화를 만들어내는 일이다. 개별 리팩토링은 아주 작을 수도 있고, 작은 단계 여러 개가 합쳐진 모습일 수도 있다.  
  따라서 리팩토링하는 동안에는 코드가 항상 정상 작동하기 때문에 전체 작업이 끝나지 않았더라도 언제든 멈출 수 있다.

> 누군가 "리팩토링하다가 코드가 깨져서 며칠이나 고생했다."라 한다면, 십중팔구 리팩토링한 것이 아니다.

- 저자는 코드베이스나 구조를 바꾸는 모든 작업을 **재구성**이라는 포괄적인 용어로 표현하고, 리팩토링은 재구성 중  
  특수한 한 형태로 본다. 한 번에 바꿀 수 있는 작업을 수많은 단계로 잘게 나눠서 작업하는 모습을 처음 접하면  
  리팩토링하는 것이 오히려 비효율적이라고 생각할 수 있다. 하지만 이렇게 잘게 나눔으로써 오히려 작업을 더 빨리  
  처리할 수 있다. 단계들이 체계적으로 구성되어 있기도 하고, 무엇보다 디버깅하는 데 시간을 뺏기지 않기 때문이다.

- 앞서 본 리팩토링의 정의 중 *겉보기 동작*이라는 표현의 의미는 리팩토링하기 전과 후의 동작이 동일해야 한다는 뜻이다.  
  그렇다고 완전히 똑같다는 말은 아닌데, 가령 **함수 추출하기**를 거치면 call stack이 달라져서 성능이 변할 수 있다.  
  그렇다해도 **사용자 관점에서는 달라지는 점이 없어야 한다.** 특히 **함수 선언 바꾸기**, **함수 옮기기**와 같은  
  리팩토링 기법을 사용하면 모듈의 인터페이스가 달라질 수도 있다. 한편, 리팩토링 과정에서 발견된 버그는 리팩토링 후에도  
  그대로 남아 있어야 한다.

- 리팩토링은 성능 최적화와 비슷하다. 둘 다 코드를 변경하지만 프로그램의 전반적인 기능은 그대로 유지한다.  
  단지 목적이 다를 뿐이다. 리팩토링의 목적은 코드를 이해하고 수정하기 쉽게 만드는 것이다. 프로그램의 성능은 좋아질 수도,  
  나빠질 수도 있다. 반면 성능 최적화는 오로지 속도 개선에만 신경 쓴다. 그래서 목표 성능에 반드시 도달해야 한다면 코드는  
  다루기에 더 어렵게 바뀔 수 있음을 각오해야 한다.

<hr/>

<h2>두 개의 모자</h2>

- 저자는 소프트웨어를 개발할 때 목적이 *기능 추가*인지, *리팩토링*인지를 명확히 구분해 작업한다.  
  켄트 백은 이를 *두 개의 모자*에 비유한다.

- 기능 추가를 할 때에는 _기능 추가_ 모자를 쓴 다음 기존 코드는 절대 건들이지 않고 새 기능을 추가하기만 한다.  
  진척도는 테스트를 추가해서 통과하는지 확인하는 방식으로 측정한다.

- 반면 리팩토링을 할 때는 _리팩토링_ 모자를 쓴 다음 기능 추가는 절대 하지 않기로 다짐한 뒤 오로지 코드 재구성에만 전념한다.  
  앞 과정에서 놓친 테스트 케이스를 발견하지 않는 한 테스트도 새로 만들지 않는다.  
  부득이 인터페이스를 변경해야 할 때만 기존 테스트를 수정한다.

- 소프트웨어를 개발할 때 개발자는 두 개 모자를 자주 바꿔 써야 한다.  
  새 기능을 추가하다 보면 코드 구조를 바꿔야 작업하기 훨씬 쉽겠다는 생각이 들기도 하는데, 그러면 잠시 모자를 바꿔쓰고  
  리팩토링한다. 코드 구조가 어느 정도 개선되면 다시 모자를 바꿔쓰고 기능 추가를 이어간다.  
  추가한 기능이 제대로 작동하는지까지 확인했다면 작성한 코드를 살펴보고, 리팩토링의 여부를 결정한다.

- 전체 작업 시간이 10분 정도로 짧다 하더라도, 항상 쓰고 있는 모자가 무엇인지와 그에 따른 미묘한 작업 방식의 차이를  
  분명하게 인식해야 한다.

<hr/>
