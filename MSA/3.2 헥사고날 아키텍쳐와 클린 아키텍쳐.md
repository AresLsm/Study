# 헥사고날 아키텍쳐와 클린 아키텍쳐

<h2>계층형 아키텍쳐</h2>

- Layered(계층형) 아키텍쳐를 구성하는 Layer는 많은 사람들이 혼동하는 물리적인 티어의 개념과 달리  
  논리적인 개념이다. 티어는 물리적인 장비나 서버 컴퓨터 등의 물리층을 의미하고, 레이어는  
  내부의 논리적인 분할을 의미한다.

- 물리적인 서버 티어의 계층을 살펴보면, 아래와 같다.

  - Presentation(상위)
  - Business Logic
  - Data Access(하위)

- 계층은 설계자들이 복잡한 시스템을 분리할 때 흔히 사용하는 패턴 중 하나로, 애플리케이션이 내부에서 처리하는  
  관심사를 논리적으로 구분한다.

- Presentation Layer의 관심사는 *화면 표현 및 전환 처리*이고, Business Logic의 관심사는  
  *비즈니스 개념 및 규칙, 흐름 제어*이며 Data Access의 관심사는 데이터 처리이다.  
  계층형 아키텍쳐는 계층 간의 응집성은 높이고 의존성은 낮추기 위해 아래와 같은 몇 가지 규칙을 둔다.

  - 상위 계층이 하위 계층을 호출하는 단방향성을 유지한다.
  - 상위 계층은 하위의 여러 계층을 알 필요 없이 바로 밑의 근접 계층만 활용한다.
  - 상위 계층이 하위 계층에 영향을 받지 않게 구성해야 한다.
  - 하위 계층은 자신을 사용하는 상위 계층을 알지 못하게 구성해야 한다.
  - 계층 간의 호출은 인터페이스를 통해 호출하는 것이 바람직하다.(구현 클래스에 직접 의존 X => 약한 결합 유지)

- 특히 인터페이스를 통한 의존성 분리는 인터페이스를 구현하는 구현체를 다양하게 해주는 다형성을 추구함으로써  
  제어 흐름을 간접적으로 전환하게 해준다.

- 일반적인 계층형 아키텍쳐는 DIP(의존성 역전 원칙)은 만족한다.
  하지만 OCP(개방 폐쇄의 원칙)은 만족하지 않는다.
  일반적인 계층형 아키텍쳐가 OCP에 위반되는 이유는 모든 계층이 각기 자신이 제공하는 기능에 대한  
  추상적인 인터페이스를 직접 정의하고 소유하기 때문이다. 이런 구조에서는 구조의 흐름이 상위 계층에서 하위 계층으로  
  흐르게 되며, 이에 따른 소스코드의 의존성은 제어 흐름의 방향대로 따를 수밖에 없다.

  > DIP(Dependency Inversion Principle): 소스코드는 추상에 의존하며, 구체에는 의존하지 않는다.  
  > OCP(Open-Closed Principle): 객체는 변경에는 닫혀있고 확장에는 열려 있다.

- 물론 상위 계층은 하위 계층의 구체 클래스가 아니라 추상 인터페이스에 의존하고, 그 인터페이스의 구현체를 달리하는  
  방법으로 의존성을 줄이고 다형성은 유지할 수 있으나, 인터페이스는 그 계층이 정의하는 추상 특성의  
  한계를 벗어날 수 없다.

- 따라서 하위 계층의 유형이 추가되어 확장될 때 닫혀 있어야 할 상위 계층이 하위 계층에서 정의한 특성에  
  영향을 받게 된다.

- 위에서 본 계층형 아키텍쳐의 규칙을 보면, 가장 하위에 있는 Data Access 계층이 변경됐을 때 Business Logic 계층은  
  변경되면 안된다. 만약 Data Access 계층의 인터페이스가 완전히 변경된다면 Business Logic 계층의 클래스가  
  Data Access 계층의 인터페이스에 의존하기에 변경의 영향을 받을 수밖에 없다.

- 즉, 문제는 Data Access 인터페이스의 위치이다. Data Access 인터페이스는 Data Access 계층에 위치한다.  
  당연해 보이지만, 이 위치 때문에 상위 계층이 하위 계층에 의존하게 된다.

- 애플리케이션에서는 비즈니스 로직이 핵심 영역이다. 그렇기에 비즈니스 로직을 보통 *고수준 영역*이라 하고, Presentation 및  
  Data Access 계층을 *저수준 영역*이라 한다. 고수준 영역은 핵심 영역이기에 보호를 받아야 하고, 따라서 저수준 영역의 변경이나  
  확장에 영향을 받지 말아야 한다. 그러나 일반적인 계층형 아키텍쳐의 규칙만 따른다면, 고수준 영역이 저수준 영역에 의존하게 되고  
  영향을 받게 된다.

- 여기서 의존성 역전 원칙(DIP)을 제대로 적용할 필요가 생긴다. DIP를 통해 Data Access 계층에서 정의한 인터페이스를  
  비즈니스 로직 계층으로 옮긴다. 그러면 Data Access 계층의 구현체는 비즈니스 로직 계층의 인터페이스를 바라볼 수밖에 없다.

- 즉, Data Access 계층이 구현해야할 인터페이스를 좀 더 고수준의 비즈니스 로직 계층에서 정의하게 함으로써  
 기존의 위에서 아래로 흘렀던 의존 관계를 역전시키고, 고수준 영역이 저수준 영역의 변경에 영향을 받지 않게 하는 것이다.
<hr/>
