<h1>TDD, 기능 명세, 설계</h1>

<h2>기능 명세</h2>

* 개발자는 코드를 작성하고 빌드하여 이를 사용자가 사용할 수 있도록 배포한다. 사용자는 배포된 소프트웨어를 이용해서 원하는   
  기능을 실행한다. 결국 코드를 작성하는 이유는 사용자가 사용할 어떤 기능을 제공하기 위함이다.

* 기능에 대한 명세는 다양한 형태로 존재한다. 어떤 형태가 되든 간에 사용자에게 제공할 기능을 구현하려면 기능을 크게 아래의   
  두 가지로 나누어 생각할 수 있다. 바로 입력과 결과이다. 예를 들어 로그인 기능을 생각해보자.
  * 입력 : 아이디, 암호
  * 결과 : 일치하면 성공, 불일치하면 실패

* 입력은 기능을 실행하는데에 필요한 값이다. 이전에 살펴본 만료일 계산기의 입력과 결과는 아래와 같다.
  * 입력 : 첫 납부일, 납부액, 납부일
  * 결과 : 만료일

* 입력은 보통 메소드의 파라미터로 전달한다. 만료일 계산 기능은 필요한 값을 객체화하여 파라미터로 전달했다.
```java
LocalDate realExpiryDate = calculator.calculateExpiryDate(payData);
```

* 결과는 여러 형식으로 정의할 수 있다. 가장 쉽게 생각할 수 있는 결과 형식은 리턴값이다.   
  만료일 계산 기능은 결과로 리턴 값을 사용했다. 반면, 예외를 결과로 사용할 수도 있다. 로그인 기능을 생각해보자.
```java
public void login(String id, String pw) {
    User user = getUser(id);
    if(!user.matchPassword(pw)) {
        throw new IdPwMismatchException();
    }
    //..
}
```

* 기능 실행 결과에는 변경도 포함된다. 예를 들어 회원 가입 기능은 실행 결과로 DB에 회원 정보를 추가한다. DB에 데이터를   
  추가하는 것은 값을 리턴하는 것과 달리 시스템의 상태를 변경한다. 이런 값은 리턴값으로는 확인할 수 없기 때문에 테스트 대상을   
  실행한 뒤에는 변경 대상에 접근해서 결과를 확인해야 한다. 이 경우 DB에 접근해서 데이터의 삽입을 확인해야 한다.

* 설계는 기능 명세로부터 시작한다. 스토리보드를 포함한 다양한 형태의 요구사항 문서를 이용해서 기능 명세를 구체화한다.   
  기능 명세를 구체화하는 동안 입력과 결과를 도출하고 이렇게 도출한 기능 명세를 코드에 반영한다. 기능 명세의 입력과 결과를 코드에   
  반영하는 과정에서 기능의 이름, 파라미터, 리턴 타입 등이 결정된다. 이는 곧 기능에 대한 설계 과정과 연결된다.
<hr/>

<h2>설계 과정을 지원하는 TDD</h2>

* TDD는 테스트를 만드는 것부터 시작한다. 테스트 코드를 먼저 만들고 테스트를 통과시키기 위해 코드를 구현하고 리팩토링하는 과정을   
  반복한다. 여기서 중요한 것은 __테스트 코드를 먼저 작성해야 한다__ 는 점이다. 테스트 코드를 먼저 만들기 위해 필요한 것들 중   
  아래의 두 가지를 보자.
  * 테스트할 기능을 실행
  * 실행 결과를 검증

* 먼저 기능을 실행할 수 없으면 테스트를 할 수 없다. 테스트는 기능을 실행한 결과를 검증하는 것이므로 테스트 코드에서 기능을   
  실행할 수 있어야 한다. 즉 테스트에서 실행할 수 있는 객체나 함수가 존재해야 한다.

* 실행할 객체가 존재하려면 객체를 생성할 때 사용할 클래스가 필요하고, 실행할 메소드도 필요하다. 다시 말해 테스트 대상이 되는   
  클래스와 메소드명을 결정해야 한다. 또한 메소드를 실행할 때 사용할 인자의 타입과 개수도 고려해야 한다.

* 테스트는 기능이 올바르게 작동하는지를 검증하는 것이므로 당연히 실행 결과를 검증해야 한다. 이를 위해 실행 결과를 어떻게   
  검증할 수 있는지를 고민해야 한다.

* 이렇게 TDD에서 테스트 코드를 작성할 때 고민하는 것들과 설계 과정에서 고민하는 것은 겹치는 부분이 있다.   
  즉, TDD 자체가 설계는 아니지만 TDD를 하다보면 테스트 코드를 작성하는 과정에서 일부 설계를 진행하게 된다.

<h3>필요한 만큼 설계하기</h3>

* TDD는 테스트를 통과할 만큼만 코드를 작성한다. 필요할 것으로 예측해서 미리 코드를 만들지 않는다. 이는 설계에도 동일하게 적용된다.   
  필요할 것으로 예측해서 미리 설계를 유연하게 만들지 않는다. 실제 테스트 사례를 추가하고 통과시키는 과정에서 필요한 만큼   
  설계를 변경한다.

* 기능 실행 결과도 미리 앞서서 필요해 보이는 Exception을 만들지 않는다. 테스트를 진행하는 과정에서 실제 Exception이 필요한 시점에   
  예외 클래스를 도출한다. 예를 들어, 중복된 ID가 존재하는 경우 회원 가입에 실패하는 테스트를 추가하는 시점에 비로소 해당하는   
  Exception 타입을 추가한다.

* TDD로 개발을 진행하면 현시점에서 테스트를 통과시키는데 필요한 만큼의 코드만 만들게 된다. 물론 모든 코드에 대해 테스트를 먼저   
  작성할 수는 없겠지만 TDD로 개발하는 코드 비율이 높아질수록 지금 시점에서 필요한 설계만 코드에 반영할 가능성이 커진다.   
  유연한 설계는 필요한 시점에 추가함으로써 설계가 불필요하게 복잡해지는 것을 방지할 수 있다.

* TDD로 개발할 때 필요한 만큼 설계를 한다고 해서 사전에 설계 활동을 생략하는 것은 아니다. 요구사항을 분석하는 과정에서 당연히   
  설계를 진행한다. 단 이때 설계한 결과물은 초안에 불과하다. 이 초안대로 끝까지 개발된다는 보장은 없으며, 최초 요구사항은    
  시간이 지나면 변한다. 요구사항이 바뀌므로 필요하다고 생각했던 설계 요소가 불필요해질 때도 있고, 반대로 처음에는 예상하지 못했던   
  설계 요소가 나중이 되서야 떠오르기도 한다. TDD는 미리 앞서 코드를 만들지 않으므로 불필요한 구성 요소를 덜 만들게 된다.
<hr/>

<h2>기능 명세 구체화</h2>

* 테스트 코드를 작성하기 위해 개발자는 기능 명세를 정리해야 한다. 보통 개발자는 기획자가 작성한 스토리보드, 와이어프레임과 같은   
  형태로 요구사항 명세를 전달받는다.

* 테스트 코드를 작성하려면 파라미터와 결과 값을 정해야 하므로 개발자는 요구사항 문서에서 기능의 입력과 결과를 도출해야 한다.   
  또한 다양한 테스트 사례를 추가하는 과정에서 구현하기 애매한 점을 발견할 때도 있다. 테스트 코드를 작성하려면 입력과 결과가   
  명확해야 하므로 애매한 점을 발견하면 기획자 또는 실무 담당자와 얘기해서 상황에 따라 기능이 어떻게 동작해야 하는지를 구체적으로   
  정리해야 한다. 테스트 코드는 구체적인 입력과 결과를 이용해서 작성하므로 개발자는 예시를 통해 기능 명세를 구체화하게 된다.

* 모호한 상황을 만나면 이를 구체적인 예시로 바꾸어 테스트 코드에 반영한다. 즉 테스트 코드는 예시를 이용한 구체적인 명세가 된다.   
  구체적인 예시들은 개발자가 요구사항을 더 잘 이해할 수 있게 만든다.

* 또한, 테스트 코드는 바로 실행할 수 있다. 테스트 코드를 이용하면 구체적인 예시를 이용하여 기능을 바로 실행해볼 수 있다.   
  이는 유지보수에 큰 도움이 된다. 특정 상황에서 코드가 어떻게 동작하는지 이해하고 싶다면 해당 상황을 검증하는 테스트를   
  실행하고 이해가 필요한 코드를 추적하면 된다.
<hr/>