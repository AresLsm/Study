# 구글 드라이브 설계

- 설계에 들어가기 앞서 일단 구글 드라이브가 어떤 서비스인지 알아보자.  
  구글 드라이브는 파일 저장 및 동기화 서비스로 문서, 사진, 비디오, 기타 파일을 클라우드에 보관할 수 있도록 한다.  
  이 파일은 컴퓨터, 스마트콘, 태블릿 등 어떠한 단말에서도 이용 가능해야 한다. 아울러 보관된 파일은 친구, 가족, 동료 등  
  다른 사용자와 손쉽게 공유할 수 있어야 한다.

## 문제 이해 및 설계 범위 확정

> 구글 드라이브를 설계하는 것은 매우 큰 프로젝트이니, 질문을 통해 설계 범위를 좁히도록 하자.

- 아래는 가장 중요하게 지원해야할 기능 및 요구사항이다.

  - 가장 중요하게 지원해야 할 기능: 파일 업로드/다운로드, 파일 동기화, 알림
  - 모바일 앱, 웹 앱 모두 지원
  - 파일 암호화가 필요하다.
  - 파일 크기는 10GB의 제한이 있다.
  - DAU는 1000만이다.

- 이번 장에서는 아래 기능들의 설계에 집중할 것이다.

  - 파일 추가: ex) drag-and-drop
  - 파일 다운로드
  - 여러 단말에 파일 동기화. 한 단말에서 파일을 추가하면 다른 단말에도 자동으로 동기화되어야 한다.
  - 파일 갱신 이력 조회(revision history)
  - 파일 공유
  - 파일이 편집되거나 삭제되거나 새롭게 공유되었을 때 notification

- 이번 장에서 다루지 않을 기능들은 아래와 같다.

  - Google Docs 편집 및 협업 기능

- 기능적 요구사항 이외에 아래의 비 기능적 요구사항을 이해하는 것도 중요하다.

  - 안정성: 저장소 시스템에서 안정성은 아주 중요하다. 데이터 손실은 발생하면 안된다.
  - 빠른 동기화 속도: 파일 동기화에 시간이 너무 많이 걸리면 UX를 매우 손상시킬 것이다.
  - 네트워크 대역폭: 이 제품은 네트워크 대역폭을 불필요하게 많이 소모하면 안된다. 이또한 UX를 해칠 수 있다.
  - 규모 확장성: 이 시스템은 아주 많은 양의 트래픽도 처리할 수 있어야 한다.
  - 높은 가용성: 일부 서버에 장애가 발생하거나, 느려지거나, 네트워크 일부가 끊겨도 시스템은 계속 사용 가능해야 한다.

### 개략적 추정치

- 가입 사용자는 5000만명이고, DAU는 1000만명이다.
- 모든 사용자에게 10GB의 무료 저장 공간을 할당할 수 있어야 한다.
- 매일 각 사용자가 평균 2개의 파일을 업로드한다고 가정한다. 각 파일의 평균 크기는 500KB 이다.
- 읽기, 쓰기 연산의 비율은 1:1이다.
- 필요한 저장공간의 총량은 `5000만 사용자 * 10GB = 500Petabyte` 이다.
- 업로드 API의 QPS는 `1천만 사용자 * 2회 업로드 / 24시간/3600초 = 약 240` 이다.
- 최대 QPS는 `QPS * 2 = 480` 이다.

---
