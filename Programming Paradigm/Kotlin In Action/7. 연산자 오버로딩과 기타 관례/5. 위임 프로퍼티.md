# 프로퍼티 접근자 로직 재활용: 위임 프로퍼티

- 이번에는 코틀린이 제공하는 관례에 의존하는 특성 중 독특하면서도 강력한 기능인 **위임 프로퍼티(delegated property)** 에  
  대해 알아보자. 위임 프로퍼티를 사용하면 값을 backing field에 단순히 저장하는 것보다 더 복잡한 방식으로 작동하는  
  프로퍼티를 쉽게 구현할 수 있다. 또한 그 과정에서 접근자 로직을 매번 재구현할 필요도 없다. 예를 들어, 프로퍼티는  
  위임을 사용해 자신의 값을 필드가 아니라 데이터베이스 테이블이나 브라우저 세션, 맵 등에 저장할 수 있다.

- 이런 특성의 기반에는 **위임**이 있다. 위임은 객체가 직접 작업을 수행하지 않고, 다른 도우미 객체가 그 작업을  
  처리하게 맡기는 디자인 패턴을 말한다. 이때 작업을 처리하는 도우미 객체를 **위임 객체(delegate)** 라 한다.  
  이전에 클래스 위임에 대해 다룰 때 이 패턴을 이미 보았다. 여기서는 그 패턴을 프로퍼티에 적용해서 접근자 기능을  
  도무이 객체가 수행하도록 위임한다. 도우미 객체를 직접 작성할 수도 있지만, 더 나은 방법은 코틀린 언어가 제공하는  
  기능을 활용하는 것이다.

- 참고로 클래스 위임을 다루는 예시 코드는 아래와 같았다.

```kt
class CountingSet<T> (
    val innerSet: MutableCollection<T> = HashSet<T>()
) : MutableCollection<T> by innerSet {

    var objectsAdded = 0

    override fun add(element: T): Boolean {
	objectsAdded++
	return innerSet.add(element)
    }

    override fun addAll(elements: Collection<T>): Boolean {
	objectsAdded += elements.size
	return innerSet.addAll(elements)
    }
}
```

## 위임 프로퍼티 소개

- 위임 프로퍼티의 일반적인 문법은 아래와 같다.

```kt
class Foo{
    var p: Type by Delegate()
}
```

- p 프로퍼티는 접근자 로직을 다른 객체에게 위임한다. 위에서는 `Delegate` 클래스의 인스턴스를 위임 객체로  
  사용한다. by 뒤에 있는 식을 계산해서 위임에 쓰일 객체를 얻는다. 프로퍼티 위임 객체가 따라야 하는 관례를  
  따르는 모든 객체를 위임에 사용할 수 있다.

- 아래와 같이 컴파일러는 숨겨진 도우미 프로퍼티를 만들고, 그 프로퍼티를 위임 객체의 인스턴스로 초기화한다.  
  p 프로퍼티는 바로 그 위임 객체에게 자신의 작업을 위임한다. 예를 들어, 이 감춰진 프로퍼티의 이름을  
  delegate라고 해보자.

```kt
class Foo {
    private val delegate = Delegate()
    var p: Type
    set(value: Type) = delegate.setValue(..., value)
    get() = delegate.getValue(...)
}
```

- 위임 프로퍼티 관례를 따르는 `Delegate` 클래스는 `getValue()`와 `setValue()` 메소드를  
  제공해야 한다. 물론 변경 가능한 프로퍼티만 `setValue()`를 사용한다. 관례를 사용하는 다른 경우와  
  마찬가지로 `getValue()`와 `setValue()`는 멤버 메소드이거나, 확장함수일 수 있다.  
  `Delegate`를 매우 단순화하면 아래와 같다.

```kt
class Delegate {
    operator fun getValue(/*...*/): { /*...*/ }
    operator fun setValue(/*...*/, value: Type) { /*...*/ }
}

class Foo {
    var p: Type by Delegate()
}

// client
val foo = Foo()
val oldValue = foo.p
foo.p = newValue
```

- foo.p는 일반 프로퍼티처럼 쓸 수 있고, 일반 프로퍼티와 같아 보인다. 하지만 실제로 p의 getter나 setter는  
  `Delegate` 타입의 위임 프로퍼티 객체에 있는 메소드를 호출한다.

<hr/>
