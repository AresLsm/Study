# 운영체제(Operating System)

## 운영체제의 정의

- 컴퓨터 사용자와 컴퓨터 하드웨어 사이의 중개자 역할을 하는 프로그램

### 운영체제의 목표

- 사용자의 프로그램을 실행하고 사용자 문제를 보다 쉽게 해결할 수 있게 한다.
- 컴퓨터 시스템을 사용하기 편리하게끔 한다.
- 컴퓨터 하드웨어를 효율적으로 사용하게 한다.

### 컴퓨터 시스템의 구조(4가지 요소)

- 하드웨어: 기본적인 컴퓨팅 리소스 제공
  - CPU, Memory, I/O Device
- 운영체제: 다양한 응용 프로그램 및 사용자 간의 하드웨어 사용을 제어하고 조정
- 응용 프로그램: 사용자의 컴퓨팅 문제를 해결하기 위해 시스템 자원을 사용하는 방법 정의
- 사용자: 사람, 기계, 컴퓨터 등

### 운영체제가 하는 일

- 사용자의 관점

  - 사용자는 편리함 및 좋은 성능을 원한다. 즉, 자원의 이용률에는 관심이 없다.
  - 그러나 메인프레임 또는 미니컴퓨터와 같은 공용 컴퓨터는 모든 사용
  - 워크스테이션 등의 전용 시스템 사용자는 전용 자원을 가지고 있지만, 종종 서버가 제공하는 공유 자원을 사용한다.
  - 휴대용 컴퓨터 등은 최적화된다.

- 시스템 관점

  - 자원 할당자(Resource Allocator)

    - OS는 CPU 시간, 메모리 공간, 파일 저장 공간, 입출력 장치 등의 자원 관리자로서 동작하며, 특정 프로그램과 사용자에게 작업 수행을 위해  
      필요한 자원을 할당한다.
    - 특정 프로그램과 사용자에 대해 자원을 할당해야 하므로 컴퓨터 시스템을 효율적이고 공정하게 운영할 수 있도록 자원 할당을 결정한다.

  - 여러 입출력 장치와 사용자 제어 프로그램(Control Program)
    - 오류와 컴퓨터의 부적절한 사용을 방지한다.
    - 특히 사용자 프로그램이 실행하는 입출력 장치의 연산과 제어에 깊이 관여한다.

- OS의 존재 이유는 컴퓨터 시스템을 만드는 과정에서 발생하는 문제점들을 해결하기 위한 방법을 제공하기 위함이다.

- 일반적인 OS의 정의에 따르면, **OS는 컴퓨터에서 항상 실행되는 하나의 프로그램**이다.
  - 커널: 컴퓨터에서 항상 실행되는 유일한 프로그램
  - 시스템 프로그램: OS와 연관되어 있으나 반드시 커널에 포함될 필요는 없는 프로그램
  - 응용 프로그램: 시스템의 작동과 관계 없는 프로그램

### 컴퓨터 시스템 연산

- 컴퓨터가 구동하기 위해서는 실행시킬 초기 프로그램을 갖고 있어야 한다.  
  이러한 초기 프로그램(Bootstrap Program)은 전원이 공급되는 시점, 혹은 다시 boot될 때 적재된다.  
  통상 ROM 또는 EPROM이라 불리며 firmware라 불린다.

- Unix의 경우 첫 시스템 프로세스는 `init`이며, init은 다른 많은 daemon들을 시작시킨다.  
  이후 시스템은 완전히 boot된 상태가 되며, event(사건)가 발생하기를 기다린다.

  - Event의 발생여부는 하드웨어나 소프트웨어로부터 발생한 interrupt에 의해 전달받는다.
    - 하드웨어는 언제든지 시스템 버스를 통해 CPU에게 신호를 보내 interrupt를 발생시킨다.
    - 소프트웨어는 syscall이라 불리는 특별한 연산을 실행한다.
  - CPU가 interrupt되면 CPU는 하던 일을 중단하고, 즉시 지정된 위치로 실행 위치를 옮긴다.
    - 지정된 위치에는 interrupt를 처리하기로 되어 있는 서비스 루틴의 시작 주소가 기록된다.
  - Interrupt service routine이 실행되고, 실행이 완료되면 CPU는 interrupt되었던 연산을 재개한다.

- 입출력 장치와 CPU는 병행 실행된다.
- 각 장치 제어기는 특정 유형의 장치를 책임지며, 각각 지역 버퍼를 갖는다.
- CPU는 메인 메모리에서 지역 버퍼로, 혹은 지역 버퍼에서 메인 메로리로 데이터를 이동시킨다.
- 입출력은 장치에서 제어기의 지역 버퍼로 데이터를 이동하는 것을 의미한다.
- 장치 제어기는 interrupter를 발생시켜 CPU에게 연산이 끝났음을 알린다.

### Interrupt의 공통 기능

- Interrupt는 컴퓨터 구조의 중요한 부분으로 각자 자신만의 interrupt 기법을 가지며 아래와 같은 공통적인 기능을 갖는다.

  - 적절한 서비스 루틴으로 interrupt의 제어권을 넘긴다.
    - 모든 서비스 루틴의 주소를 저장하고 있는 자료구조를 **인터럽트 벡터**라 한다.
  - Interrupt된 명령어의 주소를 저장한다.
    - 소프트웨어가 발생시킨 interrupt: 트랩 또는 예외

- OS는 interrupt가 발생해야 작동하는 방식으로 interrupt driven 방식으로 동작한다.

### Interrupt Handling

- OS가 register와 program counter를 저장해 interrupt 발생 순간의 CPU 상태를 보존한다.

- 발생한 interrupt의 유형을 파악하는 방식으로는 두 가지 방법이 있다.

  - Polling: 하나의 장치 혹은 프로그램이 충돌회피 또는 동기화 처리를 목적으로 다른 장치의 상태를 주기적으로 검사해 일정한 조건을 만족할 때  
    송수신 등의 처리를 하는 방식
  - Vectored interrupt system: Interrupt 요청과 함께 전달된 고유한 장치번호로 색인되어 interrupt를 촉발한 장치를 위한 서비스 루틴의 주소

### 저장 장치 구조

- 메인 메모리: CPU가 직접 접근 가능한 유일한 대용량 저장 매체(random access, 휘발성을 지닌다.)
- 보조 저장 장치: 대용량 비휘발성 저장 용량을 제공하는 메인 메모리의 확장
- 하드 디스크
- SSD: 하드 디스크보다 빠른 비휘발성 저장 매체

### 저장 장치 계층 구조

- 저장 장치 시스템은 계층 구조를 형성한다.

  - 속도
  - 비용
  - 휘발성 여부

- Caching: 더 빠른 저장장치로, 정보를 복사하는 기법이다. 메인 메모리를 보조 저장장치의 cache로 볼 수 있다.
- 입출력을 관리하기 위해 장치마다 Device Driver(장치 드라이버)가 있다.

### Caching

- 하드웨어, OS, 소프트웨어 등 컴퓨터의 많은 레벨에서 수행된다.
- 사용 중인 정보는 느린 장치에서 빠른 장치로 임시적으로 복사되며, 연산이 수행될 때 우선 cache를 검사해 cache에 정보가 있다면 그것을 사용하고  
  존재하지 않으면 데이터를 caching해놓는다.

### 입출력 구조

- 입출력이 시작되면 제어권은 완료를 기다리지 않고 바로 사용자 프로그램에게 넘어간다.

  - System Call: 사용자가 입출력 완료를 대기할 수 있도록 OS에게 요청
  - Device-status table(장치 상태 테이블): 장치마다의 유형, 주소와 상태 표기

## 컴퓨터 시스템 구조

- 단일 처리기 시스템(Single processor system)

  - 사용자 프로세스의 명령어를 포함해 범용 명령어 집합을 실행할 수 있는 하나의 주 CPU를 갖는다.

- 다중 처리기(Multiprocessors): 병렬 시스템, 멀티코어 시스템이라고도 불린다.

  - 매우 밀접한 통신을 하는 두개 이상의 처리기를 가지며 이들은 컴퓨터 버스, clock, 메로리와 주변 장치를 공유한다.

  - 장점
    - 증가된 처리량: N개의 처리기를 사용하면 그만큼 처리량이 많아진다.
    - 규모의 경제: 처리기기가 주변장치, 대용량 저장장치, 전원공급장치를 공유함으로써 비용이 절감된다.
    - 증가된 신뢰성: 한 처리기만 고장 나더라도 시스템이 정지하지 않고, 단지 속도가 느려지는 것에 그친다.

- 비대칭 다중처리(Asymmetric Multiprocessing): 각 처리기가 특별한 임무를 수행한다.

- 대칭 다중처리(Symmetric Multiprocessing, SMP)

  - SMP는 두 개 이상의 동일한 프로세서가 하나의 메모리, I/O Device, interrupt 등의 자원을 공유하며 단일 시스템 버스를 통해 각각의 프로세서는  
    다른 프로그램을 실행하고, 다른 데이터를 처리하도록 된 시스템이다.

### Clustered System

- Multiprocessing 시스템과 같이 여러 개의 시스템이 함께 작업하게 한다.

  - 보통 SAN(Storage-Area Network)을 이용해 저장 장치를 공유한다.
  - 실패해도 지속 가능한 High Availability를 제공한다.

    - Asymmetric Clustering에서는 기기 하나가 hot-standby 상태이다.(긴급 대기)
    - Symmetric Clustering에서는 여러 node가 응용 프로그램을 실행하고, 서로를 모니터링한다.

  - 일부 cluster는 고성능 컴퓨팅 환경을 제공한다.

    - 응용 프로그램은 병렬처리가 가능하도록 작성되어야 한다.

  - 일부 cluster는 Distributed Lock Manager(분산 잠금 관리자)를 제공해 상충하는 연산을 막는다.

### 프로세스 관리

- 프로세스는 실행 중인 프로그램으로, 시스템 내에서 작업의 단위가 된다.  
  하나의 프로그램은 디스크에 저장된 파일과 같은 **수동적인 개체**이고, 프로세스는 수행할 명령들을 저장하는 프로그램 카운터를 가진 **능력을 가진 개체**이다.

- 프로세스는 자신의 업무를 수행하기 위해 CPU시간, 메모리, I/O 장치 등의 자원이 필요하며, 종료될 때 재사용이 가능한 모든 자원을 반환한다.

- 단일 **스레드 프로세스**는 하나의 프로그램 카운터를 갖는다.

  - 프로그램 카운터는 다음에 실행할 명령어의 주소를 저장하며, 프로세스는 명령어를 순차적으로 한 번에 하나씩 완료될 때까지 실행한다.

- 다중 스레드 프로세스는 스레드마다 하나의 프로그램 카운터를 갖는다.

- 보통 시스템은 많은 프로세스가 존재하는데, CPU를 프로세스, 스레드에 다중 배정함으로써 병행성을 얻는다.

- OS는 프로세스의 관리와 더불어 아래와 같은 활동을 책임지고 수행해야 한다.

  - 사용자와 시스템 프로세스의 생성 및 제거
  - 프로세스의 실행 중단 및 재개
  - 프로세스끼리의 동기화 방식 제공
  - 프로세스끼리 통신할 수 있는 방법 제공
  - 교착상태를 처리하기 위한 방법 제공

### 컴퓨팅 환경 - 가상화(Virtualization)

- OS가 다른 OS 내에서 하나의 응용 프로그램처럼 실행될 수 있게 하는 기술

  - Emulation: 소스 CPU의 종류가 목표 CPU의 종류와 다를 때 사용
    - 일반적으로 가장 느린 방법이고, 프로그래밍 언어가 기계어 코드로 번역되지 않아 interpretation을 사용한다.
  - Virtualization: OS는 실행되는 CPU의 기계어로 컴파일되고, 같은 CPU의 기계어로 컴파일된 Guest OS를 실행한다.
