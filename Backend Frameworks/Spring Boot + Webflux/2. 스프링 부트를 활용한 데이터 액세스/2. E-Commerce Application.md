# E-Commerce Application

<h2>도메인 정의</h2>

- 이번에는 데이터베이스를 연결하고, 실제 이커머스 사이트를 모델링해보자.  
  시작하기 전에 아래의 의존성을 추가해주자.

```gradle
//..

dependencies {
    //..
    implementation("org.springframework.boot:spring-boot-starter-data-mongodb-reactive")
    implementation("de.flapdoodle.embed:de.flapdoodle.embed.mongo")
    implementation("org.mongodb:mongodb-driver-sync")
}
```

- `spring-boot-starter-data-mongodb-reactive`는 Spring Boot Starter이다.  
  이 패키지는 아래의 4개 의존성을 내부적으로 포함한다.

  - `spring-boot-starter`: 스타터를 연결해서 사용할 수 있게 해주는 스프링 부트 핵심 모듈
  - `spring-data-mongodb`: 블로킹 방식 MongoDB 드라이버가 제외된 Spring Data MongoDB
  - `mongodb-driver-reactivestreams`: MongoDB 공식 리액티브 스트림 드라이버
  - `reactor-core`: 프로젝트 리액터 코어 모듈

- `spring-boot-starter-data-mongodb-reactive`는 Spring Data MongoDB를 포함하며,  
  특히 리액티브 버전이 들어있다. (블로킹 버전: `spring-boot-starter-data-mongodb`)  
  Spring Data MongoDB는 리액티브 스트림을 완벽히 지원하며, 아주 쉽게 리액티브 방식으로  
  협업할 수 있게 해준다.

- `de.flapdoodle.embed:flapdoodle.embed.mongo`는 내장형 MongoDB 도구이다.  
  테스트에 주로 사용하며, 애플리케이션 초기 설계 단계에서 data store로 사용할 수 있다.

- 마지막으로 `mongodb-driver-sync`는 리액티브가 아닌 전통적인 MongoDB 드라이버이다.

- 간단한 이커머스 도메인을 정의해보자.

| 도메인 객체               | 설명                                             |
| ------------------------- | ------------------------------------------------ |
| 판매 상품(inventory item) | 일련번호, 가격, 설명 필요                        |
| 장바구니(Cart)            | 장바구니 식별자와 장바구니에 담긴 상품 목록 필요 |
| 구매 상품(Item in a cart) | 장바구니에 담긴 판매 상품의 구매 수량 필요       |

- 먼저 판매 상품부터 정의해보자.

<h3>판매 상품(Item)</h3>

```kt
class Item {
    @Id
    var id: String? = null
    var name: String = ""
    var price = 0.0

    private constructor() {}

    constructor(name: String, price: Double) {
        this.name = name
        this.price = price
    }
}
```

- Spring Data MongoDB를 사용하므로, 어떤 필드를 MongoDB의 ObjectId 값으로 사용할지를 `@Id` 어노테이션으로 지정했다.

- 이제 MongoDB에서 사용될 데이터를 담은 POJO 클래스를 정의해보자.  
  MongoDB에 저장할 객체를 정의할 때는 MongoDB 어노테이션을 사용하는 등 추천할만한 권장 사항을 따르는게 좋다.

- Spring Data는 사용할 데이터 스토어에 맞는 적절한 관례를 사용하도록 권장한다.  
  모든 데이터 스토어에 범용적으로 적용할 수 있는 유일한 해법 같은 것은 없다.  
  따라서 Redis를 사용할 때 썼던 그대로 MongoDB에서도 동작할 것이라 생각하면 안된다.

<h3>아이템과 구매할 상품을 장바구니에 추가하는 작업</h3>

- 우선 아이템과 수량을 포함하는 구매 상품 데이터 클래스를 만들어보자.

```kt
class CartItem {

    var item: Item? = null
    var quantity: Int = 0

    private constructor() {}

    constructor(item: Item) {
        this.item = item
        this.quantity = 1
    }
}
```

- 마지막 도메인 객체로 구매 상품(CartItem)을 담는 장바구니(Cart)이다.

```kt
class Cart {

    @Id
    var id: String? = null
    var cartItems: List<CartItem> = mutableListOf()

    private constructor() {}

    constructor(id: String) {
        this.id = id
        this.cartItems = mutableListOf()
    }

    constructor(id: String, cartItems: List<CartItem>) {
        this.id = id
        this.cartItems = cartItems
    }
}
```

- `Cart`는 유일한 식별자를 가지고 있으며, 구매 상품(`CartItem`)들을 저장할 Java 컬렉션도 가지고 있다.

<hr/>
