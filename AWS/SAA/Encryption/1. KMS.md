# KMS

## What is KMS?

### What is data encryption?

- Information is altered rendering plaintext data unreadable through mathematical algorithms and  
  encryption keys.

- An encryption key is required to revert the ciphertext back to plaintext.

- A key is a string of characters; the longer the key, the more robust the encryption.

- This encryption can be categorized by symmetric or asymmetric cryptography.

### Symmetric cryptography

- A **single key** is used to both encrypt and decrypt data.

- If the data was being reed by a different person, that person would need to be issued the same key.

- If the key is intercepted during the transmission, any data associated could be easily decrypted.

  - AWS KMS resolves this issue by acting as a central repository, governing and storing the keys required  
    and only issues the decryption keys to those who have sufficient permissions to do so.

- Some commoly used symmetric cryptography algorithms are:
  - AES
  - DES
  - Triple-DES
  - Blowfish

> AWS KMS only uses symmetric cryptography.

### KMS(Key Management Service)

- KMS is a managed service used to store and generate encryption keys that are used by other AWS services and applications.

  - For example, S3 may use the KMS to enable S3 to offer and perform server-side encryption using SSE-KMS.

- KMS contains the keys to decrypt your private data.

  - Administrators at AWS do not have access to your keys within KMS.
  - All administrative actions require dual authentication by two Amazon administrators.
  - It's our(customer) responsibility to administer our own encryption keys.

- KMS is for **encryption at rest**.  
  KMS does not perform encryption for data in transit or in motion.

#### Encryption at rest

- Server-side encryption

  - Encryption is done by the server.
  - Backend servers that encrypt the data as it arrives transparent to the end user.(ex. SSE-KMS)
  - The overhead of performing encryption and managing the keys is handled by the server.

- Client-side encryption

  - Encryption is done by the end user.
  - Requires the user to interact with the data to make the data encrypted.
  - The overhead of encryption process is on the client.

### Compliance and Regulations

- KMS works seamlessly with AWS CloudTrail to audit and track how your encryption keys are being used and by whom.

### Regions

- For most cases, KMS is a regional service.

---

## Components of KMS

### Key componente of KMS

- CMK(Customer Master Keys)
- DEK(Data Encryption Keys)
- Key Policies
- Grants

### CMK(Customer Master Keys)

- This is the main key type within KMS.
- This key can encrypt data up to 4KB in size.
- It is typically used in relation to your DEKs.
- The CMK can generated, encrypt and decrypt these DEKs.

- There are 2 types of CMKs:

  - AWS Managed CMKs:

    - These are used by other AWS services that interact with KMS to encrypt data.
    - They can only be used by the service that created them within a particular region.
    - They are created on the first time you implement encryption using that service.

  - Customer Managed CMKs:
    - These provide the ability to implement greater flexibility.
    - You can perform rotation, governing issues and key policy configuration.
    - You are able to enable and disable the key when it is no longer needed.

  > AWS services can also be configured to user your own customer CMKs.

### DEK(Data Encryption Keys)

- DEKs are used to encrypt your data of any size.

#### Process of SSE-KMS(Server side encryption of S3 objects) encryption

- (1) End user or client uploads the object to S3, specifying that SSE-KMS should be used.
- (2) S3 contacts KMS, and using the specified CMK, KMS generates two data keys:
  - A plain text data key.
  - An encrypted version of that data key.
- (3) Boths of these keys created by KMS are sent back to S3, at which point S3 can then encrypt  
  the object that was uploaded using the plain text data key to generate an encrypted version of your object.
- (4) S3 stores the encrypted data key and the encrypted object.
  - Plain text data key is deleted from the memory.

#### Process of SSE-KMS decryption

- (1) User requests access to the encrypted object within S3.
- (2) S3 sends the associated encrypted data key to KMS to generate a plain text data key of that encrypted  
  data key, using the assocated CMK.
- (3) Plain text data key is sent back to S3 to be used to decrypt the object from KMS.
- (4) S3 decrypts the object and returns the decrypted object to the user.

### Key Policies

- The key policies allow you to define who can use an daccess a key in KMS.

  - These policies are tied to the CMKs, so they are resource-based policies.
  - Different key policies can be created for different CMKs.
  - These permissions are defined within a key policy JSON document.

### Grants

- Grants are another method of controlling access and use of the CMKs held within KMS.

  - They allow you to delegate a subset of your own access to a CMK for principals, such as another AWS  
    service within your AWS account.

  - There is less risk of someone altering the access control permissions for that CMK.
  - Grants eliminates the possibility of anyone using the permission `kms:PutKeyPolicy`.

---
