<h1>Spring Data JPA</h1>

<h2>중복 코드의 발생</h2>

* 아래 코드를 보자. `User` Entity에 대한 JPA 관련 코드이다.
```java
@Repository
public class UserRepository {

    @PersistenceContext
    private EntityManager entityManager;

    public User find(String email) {
        return entityManater.find(User.class, email);
    }

    public void save(User user) {
        entityManager.persist(user);
    }
}
```

* `Hotel` Entity가 존재한다면 다음과 같은 코드를 작성할 것이다.
```java
@Repository
public class HotelRepository {

    @PersistenceContext
    private EntityManager entityManager;

    public Hotel find(String id) {
        return entityManager.find(Hotel.class, id);
    }

    public void save(Hotel hotel) {
        entityManager.persist(hotel);
    }
}
```

* `UserRepository`와 `HotelRepository`는 다루는 Entity의 타입만 다를 뿐 `EntityManager`를 사용해서 Entity를 찾고 저장하는 코드는   
  완전히 동일한 구조를 갖는다. 이렇게 구조적으로 동일한 코드를 중복해서 작성하는 것은 좋지 않으며, 이를 해결하는 방법 중 하나가 Spring   
  Data JPA를 사용하는 것이다.
<hr/>

<h2>Spring Data JPA 소개</h2>

* Spring Framework 사용 시 Spring Data JPA를 사용하면 많은 중복 코드 작성을 줄일 수 있다. 예를 들어, Spring Data JPA를 사용하면   
  아래와 같은 인터페이스로 `UserRepository`를 구현할 수 있다.
```java
public interface UserRepository extends JpaRepository<User, String> {

    User findOne(String email);
    User save(User user);
    void delete(User user);

    @Query("SELECT u FROM User u ORDER BY u.name")
    List<User> findAll();
}
```

* `JpaRepository`는 Spring Data JPA가 제공하는 인터페이스이다. 이 인터페이스만 상속받아 정해진 규칙에 맞게 메소드를 작성하면 된다.   
  예를 들어, 식별자로 Entity를 검색하고 싶다면 이름이 `findOne()`이고 파라미터 타입이 식별자와 같은 메소드를 추가하면 된다. 나머지   
  과정은 Spring Data JPA가 알아서 해준다. 따라서 `EntityManager`를 이용한 코드를 중복해서 구현할 필요가 없다.

* Spring Data JPA는 `JpaRepository`를 상속한 인터페이스를 검색하고, 그 인터페이스를 알맞게 구현한 객체를 Spring Bean으로 등록한다.   
  위 코드의 경우, `UserRepository` 인터페이스를 구현한 객체를 Spring Context에 Bean으로 등록한다.

* `UserRepository`를 사용할 코드는 아래 처럼 의존 주입을 통해 `UserRepository` bean을 전달받고 사용하면 된다.
```java
@Service
public class GetUserListService {

    private UserRepository userRepository;

    public List<User> getAllUsers() {
        return userRepository.findAll();
    }

    @Autowired
    public void setUserRepository(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

* `Hotel` Entity를 위한 DB 연동이 필요하다면 다음과 같이 `JpaRepository`를 상속받은 인터페이스만 작성하면 된다.
```java
public interface HotelRepository extends JpaRepository<Hotel, String> {

    Hotel findOne(String id);
}
```
<hr/>

